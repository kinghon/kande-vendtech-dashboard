<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Mission Control ‚Äî Scheduled Tasks</title>
    <style>
        * { box-sizing: border-box; margin: 0; padding: 0; }
        
        :root {
            --bg: #f8f9fa;
            --surface: #f1f5f9;
            --card: #ffffff;
            --border: #e2e8f0;
            --text: #1a202c;
            --text-dim: #4a5568;
            --text-muted: #718096;
            --accent: #7c3aed;
            --scout: #3b82f6;
            --relay: #22c55e;
            --ralph: #f59e0b;
            --coordination: #7c3aed;
            --system: #6b7280;
            --pb: #06b6d4;
            --mixmax: #eab308;
        }
        
        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
            background: var(--bg);
            color: var(--text);
            line-height: 1.5;
        }
        
        .app {
            display: grid;
            grid-template-columns: 280px 1fr;
            min-height: 100vh;
        }
        
        .sidebar {
            background: var(--surface);
            border-right: 1px solid var(--border);
            padding: 24px 0;
            overflow-y: auto;
        }
        
        .sidebar-header {
            padding: 0 24px 24px;
            border-bottom: 1px solid var(--border);
        }
        
        .sidebar-title {
            font-size: 20px;
            font-weight: 700;
            color: var(--text);
            margin-bottom: 4px;
        }
        
        .sidebar-subtitle {
            font-size: 14px;
            color: var(--text-dim);
        }
        
        .nav-section {
            padding: 24px 0 16px;
        }
        
        .nav-section-title {
            font-size: 12px;
            font-weight: 600;
            text-transform: uppercase;
            letter-spacing: 1px;
            color: var(--text-muted);
            padding: 0 24px 12px;
        }
        
        .nav-links {
            list-style: none;
        }
        
        .nav-link {
            display: block;
            padding: 12px 24px;
            color: var(--text-dim);
            text-decoration: none;
            font-weight: 500;
            border-left: 3px solid transparent;
            transition: all 0.2s;
        }
        
        .nav-link:hover {
            background: rgba(124, 58, 237, 0.1);
            color: var(--text);
            border-left-color: var(--accent);
        }
        
        .nav-link.active {
            background: rgba(124, 58, 237, 0.2);
            color: var(--text);
            border-left-color: var(--accent);
        }
        
        .nav-link.disabled {
            color: var(--text-muted);
            cursor: not-allowed;
        }
        
        .main {
            padding: 24px;
            overflow-y: auto;
        }
        
        .header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 32px;
        }
        
        .header-left h1 {
            font-size: 32px;
            font-weight: 700;
            margin: 0;
        }
        
        .header-left p {
            font-size: 16px;
            color: var(--text-dim);
            margin-top: 4px;
        }
        
        .header-right {
            display: flex;
            gap: 16px;
            align-items: center;
        }
        
        .view-toggle {
            display: flex;
            background: var(--card);
            border: 1px solid var(--border);
            border-radius: 8px;
            padding: 2px;
        }
        
        .view-btn {
            padding: 8px 16px;
            background: none;
            border: none;
            color: var(--text-dim);
            font-weight: 500;
            cursor: pointer;
            border-radius: 6px;
            transition: all 0.2s;
        }
        
        .view-btn.active {
            background: var(--accent);
            color: white;
        }
        
        .status-badge {
            display: flex;
            align-items: center;
            gap: 8px;
            background: rgba(34, 197, 94, 0.1);
            border: 1px solid rgba(34, 197, 94, 0.3);
            color: #22c55e;
            padding: 6px 12px;
            border-radius: 16px;
            font-size: 12px;
            font-weight: 600;
        }
        
        .status-dot {
            width: 6px;
            height: 6px;
            background: #22c55e;
            border-radius: 50%;
            animation: pulse 2s infinite;
        }
        
        .section {
            margin-bottom: 32px;
        }
        
        .section-header {
            display: flex;
            align-items: center;
            gap: 12px;
            margin-bottom: 20px;
        }
        
        .section-title {
            font-size: 20px;
            font-weight: 700;
        }
        
        .section-count {
            background: var(--accent);
            color: white;
            padding: 4px 8px;
            border-radius: 12px;
            font-size: 12px;
            font-weight: 600;
        }
        
        .always-running {
            display: flex;
            flex-wrap: wrap;
            gap: 12px;
        }
        
        .job-pill {
            background: var(--card);
            border: 1px solid var(--border);
            border-radius: 20px;
            padding: 8px 16px;
            display: flex;
            align-items: center;
            gap: 8px;
            cursor: pointer;
            transition: all 0.2s;
        }
        
        .job-pill:hover {
            transform: translateY(-2px);
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.3);
        }
        
        .job-pill-dot {
            width: 8px;
            height: 8px;
            border-radius: 50%;
        }
        
        .job-pill-name {
            font-weight: 500;
            font-size: 14px;
        }
        
        .job-pill-schedule {
            font-size: 12px;
            color: var(--text-muted);
            font-family: 'SF Mono', Monaco, monospace;
        }
        
        .weekly-grid {
            display: grid;
            grid-template-columns: repeat(7, 1fr);
            gap: 16px;
        }
        
        .day-column {
            background: var(--surface);
            border: 1px solid var(--border);
            border-radius: 12px;
            overflow: hidden;
        }
        
        .day-header {
            background: var(--card);
            padding: 16px;
            text-align: center;
            border-bottom: 1px solid var(--border);
        }
        
        .day-name {
            font-size: 16px;
            font-weight: 600;
        }
        
        .day-jobs {
            padding: 16px;
            min-height: 200px;
            display: flex;
            flex-direction: column;
            gap: 8px;
        }
        
        .job-block {
            padding: 8px 12px;
            border-radius: 6px;
            font-size: 12px;
            font-weight: 500;
            color: white;
            cursor: pointer;
            transition: all 0.2s;
        }
        
        .job-block:hover {
            transform: translateY(-1px);
            box-shadow: 0 2px 8px rgba(0, 0, 0, 0.3);
        }
        
        .next-up {
            display: flex;
            flex-direction: column;
            gap: 12px;
        }
        
        .next-job {
            background: var(--surface);
            border: 1px solid var(--border);
            border-radius: 8px;
            padding: 16px;
            display: flex;
            justify-content: space-between;
            align-items: center;
            cursor: pointer;
            transition: all 0.2s;
        }
        
        .next-job:hover {
            border-color: var(--accent);
        }
        
        .next-job-info {
            display: flex;
            align-items: center;
            gap: 12px;
        }
        
        .next-job-dot {
            width: 10px;
            height: 10px;
            border-radius: 50%;
        }
        
        .next-job-name {
            font-weight: 600;
        }
        
        .next-job-time {
            font-size: 14px;
            color: var(--text-dim);
            font-family: 'SF Mono', Monaco, monospace;
        }
        
        .loading {
            display: flex;
            justify-content: center;
            align-items: center;
            height: 200px;
            color: var(--text-dim);
            font-size: 18px;
        }
        
        .detail-view {
            display: block;
        }
        
        .today-view {
            display: none;
        }
        
        .today-view.active {
            display: block;
        }
        
        .detail-view.hidden {
            display: none;
        }
        
        @keyframes pulse {
            0%, 100% { opacity: 1; }
            50% { opacity: 0.5; }
        }
        
        @media (max-width: 1200px) {
            .weekly-grid {
                grid-template-columns: repeat(4, 1fr);
            }
        }
        
        @media (max-width: 768px) {
            .app {
                grid-template-columns: 1fr;
            }
            
            .sidebar {
                display: none;
            }
            
            .weekly-grid {
                grid-template-columns: repeat(2, 1fr);
            }
            
            .always-running {
                flex-direction: column;
            }
        }
    </style>
</head>
<body>
    <div class="app">
        <!-- Sidebar -->
        <div class="sidebar">
            <div class="sidebar-header">
                <div class="sidebar-title">üöÄ Mission Control</div>
                <div class="sidebar-subtitle">Command Center</div>
            </div>
            
            <nav>
                <div class="nav-section">
                    <div class="nav-section-title">Mission Control</div>
                    <ul class="nav-links">
                        <li><a href="/tasks" class="nav-link">üìã Tasks</a></li>
                        <li><a href="/content" class="nav-link">üé¨ Content</a></li>
                        <li><a href="/calendar" class="nav-link active">üìÖ Calendar</a></li>
                        <li><a href="/memory" class="nav-link">üß† Memory</a></li>
                        <li><a href="/team" class="nav-link">üë• Team</a></li>
                        <li><a href="#" class="nav-link disabled">üè¢ Office</a></li>
                    </ul>
                </div>
                
                <div class="nav-section">
                    <div class="nav-section-title">VendTech Dashboard</div>
                    <ul class="nav-links">
                        <li><a href="/" class="nav-link">üè† Home</a></li>
                        <li><a href="/crm" class="nav-link">üë• CRM</a></li>
                        <li><a href="/pipeline" class="nav-link">üìä Pipeline</a></li>
                        <li><a href="/analytics" class="nav-link">üìà Analytics</a></li>
                    </ul>
                </div>
            </nav>
        </div>
        
        <!-- Main Content -->
        <div class="main">
            <div class="header">
                <div class="header-left">
                    <h1>Scheduled Tasks</h1>
                    <p>Track + prioritize all cron jobs</p>
                </div>
                <div class="header-right">
                    <div class="view-toggle">
                        <button class="view-btn active" data-view="detail">Detail</button>
                        <button class="view-btn" data-view="today">Today</button>
                    </div>
                    <div class="status-badge">
                        <div class="status-dot"></div>
                        LIVE
                    </div>
                </div>
            </div>
            
            <div class="detail-view" id="detail-view">
                <!-- Always Running Section -->
                <div class="section">
                    <div class="section-header">
                        <h2 class="section-title">‚öôÔ∏è Always Running</h2>
                        <span class="section-count" id="always-running-count">0</span>
                    </div>
                    <div class="always-running" id="always-running">
                        <div class="loading">Loading high-frequency jobs...</div>
                    </div>
                </div>
                
                <!-- Weekly Grid Section -->
                <div class="section">
                    <div class="section-header">
                        <h2 class="section-title">üìÖ Weekly Schedule</h2>
                        <span class="section-count" id="weekly-count">0</span>
                    </div>
                    <div class="weekly-grid" id="weekly-grid">
                        <div class="loading">Loading weekly schedule...</div>
                    </div>
                </div>
                
                <!-- Next Up Section -->
                <div class="section">
                    <div class="section-header">
                        <h2 class="section-title">üïê Next Up</h2>
                        <span class="section-count" id="next-up-count">0</span>
                    </div>
                    <div class="next-up" id="next-up">
                        <div class="loading">Loading upcoming jobs...</div>
                    </div>
                </div>
            </div>
            
            <div class="today-view" id="today-view">
                <div class="section">
                    <div class="section-header">
                        <h2 class="section-title">üìÖ Today's Jobs</h2>
                        <span class="section-count" id="today-count">0</span>
                    </div>
                    <div class="next-up" id="today-jobs">
                        <div class="loading">Loading today's jobs...</div>
                    </div>
                </div>
            </div>
        </div>
    </div>
    
    <script>
        let cronJobs = [];
        let currentView = 'detail';
        
        const dayNames = ['Sun', 'Mon', 'Tue', 'Wed', 'Thu', 'Fri', 'Sat'];
        
        const jobColors = {
            scout: '#3b82f6',
            relay: '#22c55e', 
            ralph: '#f59e0b',
            coordination: '#7c3aed',
            system: '#6b7280',
            pb: '#06b6d4',
            mixmax: '#eab308'
        };
        
        async function loadScheduleData() {
            try {
                const response = await fetch('/api/cron/schedule');
                const data = await response.json();
                cronJobs = data.jobs || [];
                renderScheduledTasks();
            } catch (error) {
                console.error('Error loading schedule:', error);
                document.querySelectorAll('.loading').forEach(el => {
                    el.textContent = 'Error loading schedule data';
                    el.style.color = 'var(--red)';
                });
            }
        }
        
        function renderScheduledTasks() {
            renderAlwaysRunning();
            renderWeeklyGrid();
            renderNextUp();
            renderTodayView();
        }
        
        function renderAlwaysRunning() {
            const container = document.getElementById('always-running');
            const countEl = document.getElementById('always-running-count');
            
            // High-frequency jobs (every few minutes/hours)
            const highFreqJobs = cronJobs.filter(job => {
                return job.schedule && (
                    job.schedule.includes('*/10') || 
                    job.schedule.includes('*/15') || 
                    job.schedule.includes('*/30') ||
                    job.schedule.includes('*/4') ||
                    (job.schedule.includes('*') && !job.schedule.includes('0 '))
                );
            });
            
            countEl.textContent = highFreqJobs.length;
            
            container.innerHTML = highFreqJobs.map(job => {
                const color = getJobColor(job.name);
                const schedule = extractScheduleFrequency(job.schedule);
                
                return `
                    <div class="job-pill" title="${job.description || job.name}">
                        <div class="job-pill-dot" style="background: ${color}"></div>
                        <div class="job-pill-name">${truncateName(job.name)}</div>
                        <div class="job-pill-schedule">${schedule}</div>
                    </div>
                `;
            }).join('');
        }
        
        function renderWeeklyGrid() {
            const container = document.getElementById('weekly-grid');
            const countEl = document.getElementById('weekly-count');
            
            const dailyJobs = groupJobsByDay();
            const totalJobs = Object.values(dailyJobs).reduce((sum, jobs) => sum + jobs.length, 0);
            countEl.textContent = totalJobs;
            
            container.innerHTML = dayNames.map((dayName, dayIndex) => {
                const jobs = dailyJobs[dayIndex] || [];
                
                return `
                    <div class="day-column">
                        <div class="day-header">
                            <div class="day-name">${dayName}</div>
                        </div>
                        <div class="day-jobs">
                            ${jobs.map(job => {
                                const color = getJobColor(job.name);
                                return `
                                    <div class="job-block" style="background: ${color}" title="${job.description || job.name}">
                                        ${truncateName(job.name)}
                                    </div>
                                `;
                            }).join('')}
                        </div>
                    </div>
                `;
            }).join('');
        }
        
        function renderNextUp() {
            const container = document.getElementById('next-up');
            const countEl = document.getElementById('next-up-count');
            
            // Sort jobs by next run time
            const upcomingJobs = cronJobs
                .filter(job => job.next && job.next !== 'never')
                .sort((a, b) => parseRelativeTime(a.next) - parseRelativeTime(b.next))
                .slice(0, 10);
            
            countEl.textContent = upcomingJobs.length;
            
            container.innerHTML = upcomingJobs.map(job => {
                const color = getJobColor(job.name);
                
                return `
                    <div class="next-job" title="${job.description || job.name}">
                        <div class="next-job-info">
                            <div class="next-job-dot" style="background: ${color}"></div>
                            <div class="next-job-name">${truncateName(job.name)}</div>
                        </div>
                        <div class="next-job-time">${job.next}</div>
                    </div>
                `;
            }).join('');
        }
        
        function renderTodayView() {
            const container = document.getElementById('today-jobs');
            const countEl = document.getElementById('today-count');
            
            const today = new Date().getDay();
            const todayJobs = cronJobs.filter(job => {
                return job.days && job.days.includes(today);
            });
            
            countEl.textContent = todayJobs.length;
            
            container.innerHTML = todayJobs.map(job => {
                const color = getJobColor(job.name);
                const nextRun = job.hours ? `Next: ${job.hours[0] || 0}:00` : job.next;
                
                return `
                    <div class="next-job" title="${job.description || job.name}">
                        <div class="next-job-info">
                            <div class="next-job-dot" style="background: ${color}"></div>
                            <div class="next-job-name">${job.name}</div>
                        </div>
                        <div class="next-job-time">${nextRun}</div>
                    </div>
                `;
            }).join('');
        }
        
        function getJobColor(jobName) {
            if (jobName.includes('scout')) return jobColors.scout;
            if (jobName.includes('relay')) return jobColors.relay;
            if (jobName.includes('ralph')) return jobColors.ralph;
            if (jobName.includes('standup') || jobName.includes('water-cooler') || jobName.includes('retro') || jobName.includes('briefing')) return jobColors.coordination;
            if (jobName.includes('pb-') || jobName.includes('photo')) return jobColors.pb;
            if (jobName.includes('mixmax') || jobName.includes('email')) return jobColors.mixmax;
            return jobColors.system;
        }
        
        function groupJobsByDay() {
            const dailyJobs = {};
            
            cronJobs.forEach(job => {
                if (job.days && Array.isArray(job.days)) {
                    job.days.forEach(day => {
                        if (!dailyJobs[day]) dailyJobs[day] = [];
                        dailyJobs[day].push(job);
                    });
                }
            });
            
            return dailyJobs;
        }
        
        function extractScheduleFrequency(schedule) {
            if (!schedule) return '';
            if (schedule.includes('*/10')) return 'Every 10min';
            if (schedule.includes('*/15')) return 'Every 15min';
            if (schedule.includes('*/30')) return 'Every 30min';
            if (schedule.includes('*/4')) return 'Every 4hr';
            return schedule.split(' ')[0] + ' ' + schedule.split(' ')[1];
        }
        
        function truncateName(name) {
            if (name.length > 20) return name.substring(0, 17) + '...';
            return name;
        }
        
        function parseRelativeTime(timeStr) {
            if (!timeStr || timeStr === 'never') return Infinity;
            
            const match = timeStr.match(/(\d+)([smhd])/);
            if (!match) return Infinity;
            
            const value = parseInt(match[1]);
            const unit = match[2];
            
            switch (unit) {
                case 's': return value;
                case 'm': return value * 60;
                case 'h': return value * 60 * 60;
                case 'd': return value * 24 * 60 * 60;
                default: return Infinity;
            }
        }
        
        // View toggle functionality
        document.querySelectorAll('.view-btn').forEach(btn => {
            btn.addEventListener('click', () => {
                const view = btn.dataset.view;
                currentView = view;
                
                document.querySelectorAll('.view-btn').forEach(b => b.classList.remove('active'));
                btn.classList.add('active');
                
                if (view === 'detail') {
                    document.getElementById('detail-view').classList.remove('hidden');
                    document.getElementById('today-view').classList.remove('active');
                } else {
                    document.getElementById('detail-view').classList.add('hidden');
                    document.getElementById('today-view').classList.add('active');
                }
            });
        });
        
        // Load data on page load
        loadScheduleData();
        
        // Refresh every 2 minutes
        setInterval(loadScheduleData, 2 * 60 * 1000);
    </script>
</body>
</html>