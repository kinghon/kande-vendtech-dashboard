<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <link rel="icon" type="image/png" sizes="32x32" href="/favicon-vend-32.png">
  <link rel="apple-touch-icon" sizes="180x180" href="/apple-touch-icon-vend.png">
  <title>Proposal Generator ‚Äî Kande VendTech</title>
  <style>
    * { margin: 0; padding: 0; box-sizing: border-box; }
    :root {
      --bg: #f8fafc; --card: #ffffff; --border: #e2e8f0; --text: #0f172a;
      --muted: #64748b; --accent: #3b82f6; --accent-light: #eff6ff;
      --green: #22c55e; --green-light: #f0fdf4;
      --amber: #f59e0b; --amber-light: #fffbeb;
      --red: #ef4444; --red-light: #fef2f2;
      --purple: #8b5cf6; --purple-light: #f5f3ff;
      --teal: #14b8a6; --teal-light: #f0fdfa;
      --radius: 12px;
      --kande-navy: #1e293b;
      --kande-gold: #d4a843;
    }
    body { font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif; background: var(--bg); color: var(--text); }
    .page-wrapper { max-width: 1600px; margin: 0 auto; padding: 24px 28px 60px; }
    .page-header { margin-bottom: 24px; }
    .page-header h1 { font-size: 1.5rem; font-weight: 800; display: flex; align-items: center; gap: 10px; }
    .page-header p { color: var(--muted); font-size: 0.85rem; margin-top: 4px; }

    /* Two-panel layout */
    .panels { display: grid; grid-template-columns: 400px 1fr; gap: 24px; align-items: start; }

    /* Form panel */
    .form-panel {
      background: var(--card); border: 1px solid var(--border); border-radius: var(--radius);
      padding: 24px; position: sticky; top: 80px; max-height: calc(100vh - 100px); overflow-y: auto;
    }
    .form-panel::-webkit-scrollbar { width: 6px; }
    .form-panel::-webkit-scrollbar-thumb { background: #cbd5e1; border-radius: 3px; }

    .form-section { margin-bottom: 20px; padding-bottom: 20px; border-bottom: 1px solid #f1f5f9; }
    .form-section:last-child { border-bottom: none; margin-bottom: 0; padding-bottom: 0; }
    .form-section h3 {
      font-size: 0.82rem; font-weight: 700; color: var(--muted); text-transform: uppercase;
      letter-spacing: 0.5px; margin-bottom: 12px; display: flex; align-items: center; gap: 6px;
    }

    .form-group { margin-bottom: 12px; }
    .form-group label { display: block; font-size: 0.78rem; font-weight: 600; color: var(--text); margin-bottom: 4px; }
    .form-group input, .form-group select, .form-group textarea {
      width: 100%; padding: 9px 12px; border: 1px solid var(--border); border-radius: 8px;
      font-size: 0.85rem; font-family: inherit; background: #fff; color: var(--text);
      transition: border-color 0.15s, box-shadow 0.15s;
    }
    .form-group input:focus, .form-group select:focus, .form-group textarea:focus {
      outline: none; border-color: var(--accent); box-shadow: 0 0 0 3px rgba(59,130,246,0.1);
    }
    .form-group textarea { resize: vertical; min-height: 70px; }
    .form-group .hint { font-size: 0.72rem; color: var(--muted); margin-top: 3px; }
    .form-row { display: grid; grid-template-columns: 1fr 1fr; gap: 10px; }
    .form-group select {
      appearance: none;
      background-image: url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' width='12' height='12' fill='%2364748b' viewBox='0 0 16 16'%3E%3Cpath d='M8 11L3 6h10z'/%3E%3C/svg%3E");
      background-repeat: no-repeat; background-position: right 14px center;
    }

    /* Slider */
    .slider-wrapper { display: flex; align-items: center; gap: 12px; }
    .slider-wrapper input[type="range"] {
      flex: 1; height: 6px; border: none; padding: 0; -webkit-appearance: none;
      background: #e2e8f0; border-radius: 3px; cursor: pointer;
    }
    .slider-wrapper input[type="range"]::-webkit-slider-thumb {
      -webkit-appearance: none; width: 18px; height: 18px; border-radius: 50%;
      background: var(--accent); cursor: pointer; border: 2px solid #fff;
      box-shadow: 0 1px 4px rgba(0,0,0,0.2);
    }
    .slider-value { min-width: 40px; text-align: center; font-weight: 700; font-size: 0.9rem; color: var(--accent); }

    /* Buttons */
    .btn-row { display: flex; gap: 10px; flex-wrap: wrap; margin-top: 20px; }
    .btn {
      padding: 10px 20px; border-radius: 8px; font-size: 0.85rem; font-weight: 700;
      cursor: pointer; border: none; transition: all 0.15s; font-family: inherit;
      display: inline-flex; align-items: center; gap: 6px;
    }
    .btn-primary { background: var(--accent); color: #fff; }
    .btn-primary:hover { background: #2563eb; }
    .btn-secondary { background: var(--card); color: var(--text); border: 1px solid var(--border); }
    .btn-secondary:hover { background: #f1f5f9; }
    .btn-success { background: var(--green); color: #fff; }
    .btn-success:hover { background: #16a34a; }
    .btn-amber { background: var(--amber); color: #fff; }
    .btn-amber:hover { background: #d97706; }
    .btn-sm { padding: 6px 14px; font-size: 0.78rem; }

    /* Preview panel */
    .preview-panel {
      background: var(--card); border: 1px solid var(--border); border-radius: var(--radius);
      min-height: 600px;
    }
    .preview-toolbar {
      display: flex; align-items: center; justify-content: space-between;
      padding: 12px 20px; border-bottom: 1px solid var(--border);
      background: #fafbfc; border-radius: var(--radius) var(--radius) 0 0;
    }
    .preview-toolbar-left { display: flex; align-items: center; gap: 8px; }
    .preview-toolbar-left span { font-size: 0.82rem; font-weight: 700; color: var(--muted); }
    .preview-toolbar-right { display: flex; gap: 8px; }

    .preview-empty {
      padding: 80px 40px; text-align: center; color: var(--muted);
    }
    .preview-empty .empty-icon { font-size: 3rem; margin-bottom: 16px; opacity: 0.5; }
    .preview-empty h3 { font-size: 1rem; margin-bottom: 8px; font-weight: 700; }
    .preview-empty p { font-size: 0.85rem; }

    /* Draft management */
    .drafts-bar {
      display: flex; align-items: center; gap: 8px; padding: 10px 0; margin-bottom: 12px;
      border-bottom: 1px solid #f1f5f9; flex-wrap: wrap;
    }
    .drafts-bar select { flex: 1; min-width: 0; }
    .draft-badge {
      font-size: 0.68rem; background: var(--amber-light); color: var(--amber);
      padding: 2px 8px; border-radius: 10px; font-weight: 700;
    }

    /* ===== PROPOSAL PRINT STYLES ===== */
    .proposal-content { padding: 0; }

    .proposal-content .cover-page {
      text-align: center; padding: 80px 48px 60px;
      background: linear-gradient(135deg, var(--kande-navy) 0%, #334155 100%);
      color: #fff; min-height: 500px; display: flex; flex-direction: column;
      justify-content: center; align-items: center;
      border-radius: 0 0 0 0;
    }
    .proposal-content .cover-logo {
      width: 90px; height: 90px; border-radius: 16px; margin-bottom: 20px;
      border: 3px solid var(--kande-gold); box-shadow: 0 4px 20px rgba(0,0,0,0.3);
    }
    .proposal-content .cover-title {
      font-size: 2rem; font-weight: 800; letter-spacing: -0.5px; margin-bottom: 6px;
    }
    .proposal-content .cover-tagline {
      font-size: 1rem; color: var(--kande-gold); font-weight: 600; margin-bottom: 40px;
      letter-spacing: 1px; text-transform: uppercase;
    }
    .proposal-content .cover-divider {
      width: 80px; height: 3px; background: var(--kande-gold); margin: 0 auto 40px; border-radius: 2px;
    }
    .proposal-content .cover-for {
      font-size: 0.85rem; text-transform: uppercase; letter-spacing: 2px; color: #94a3b8;
      margin-bottom: 8px;
    }
    .proposal-content .cover-property {
      font-size: 1.5rem; font-weight: 700; margin-bottom: 4px;
    }
    .proposal-content .cover-address {
      font-size: 0.9rem; color: #cbd5e1;
    }
    .proposal-content .cover-date {
      margin-top: 40px; font-size: 0.8rem; color: #64748b; text-transform: uppercase; letter-spacing: 1px;
    }

    .proposal-content .section {
      padding: 36px 48px; border-bottom: 1px solid #f1f5f9;
    }
    .proposal-content .section:last-child { border-bottom: none; }
    .proposal-content .section-title {
      font-size: 1.15rem; font-weight: 800; color: var(--kande-navy);
      margin-bottom: 16px; display: flex; align-items: center; gap: 10px;
    }
    .proposal-content .section-title .sec-num {
      background: var(--kande-navy); color: var(--kande-gold);
      width: 28px; height: 28px; border-radius: 50%; display: inline-flex;
      align-items: center; justify-content: center; font-size: 0.75rem;
      font-weight: 800; flex-shrink: 0;
    }
    .proposal-content p { margin-bottom: 12px; font-size: 0.88rem; line-height: 1.7; color: #334155; }
    .proposal-content ul { margin: 0 0 12px 20px; }
    .proposal-content li { margin-bottom: 6px; font-size: 0.86rem; line-height: 1.6; color: #334155; }

    /* Comparison table */
    .compare-table { width: 100%; border-collapse: collapse; margin: 16px 0; font-size: 0.82rem; }
    .compare-table th {
      text-align: left; padding: 10px 14px; font-weight: 700;
      border-bottom: 2px solid var(--kande-navy); color: var(--kande-navy);
      font-size: 0.75rem; text-transform: uppercase; letter-spacing: 0.5px;
    }
    .compare-table td { padding: 10px 14px; border-bottom: 1px solid #f1f5f9; }
    .compare-table tr:last-child td { border-bottom: none; }
    .compare-table .check { color: var(--green); font-weight: 700; }
    .compare-table .cross { color: var(--red); font-weight: 700; }
    .compare-table .highlight-col { background: var(--green-light); }

    /* Revenue projections card */
    .revenue-card {
      background: linear-gradient(135deg, var(--green-light) 0%, #ecfdf5 100%);
      border: 1px solid #bbf7d0; border-radius: 10px; padding: 24px; margin: 16px 0;
    }
    .revenue-row { display: flex; justify-content: space-between; align-items: center; padding: 8px 0; }
    .revenue-row + .revenue-row { border-top: 1px solid #bbf7d0; }
    .revenue-label { font-size: 0.84rem; color: #166534; font-weight: 500; }
    .revenue-value { font-size: 1.1rem; color: #166534; font-weight: 800; }
    .revenue-total { font-size: 1.3rem; }
    .revenue-note { font-size: 0.75rem; color: #16a34a; margin-top: 12px; font-style: italic; }

    /* Advantage cards */
    .advantage-grid { display: grid; grid-template-columns: 1fr 1fr; gap: 12px; margin: 16px 0; }
    .advantage-card {
      background: #fff; border: 1px solid var(--border); border-radius: 10px;
      padding: 16px; display: flex; gap: 12px; align-items: flex-start;
    }
    .advantage-icon {
      font-size: 1.4rem; width: 36px; height: 36px; border-radius: 8px;
      display: flex; align-items: center; justify-content: center; flex-shrink: 0;
      background: var(--accent-light);
    }
    .advantage-card h4 { font-size: 0.82rem; font-weight: 700; margin-bottom: 4px; }
    .advantage-card p { font-size: 0.76rem; line-height: 1.5; color: var(--muted); margin: 0; }

    /* Steps */
    .steps-row { display: flex; gap: 16px; margin: 20px 0; }
    .step-card {
      flex: 1; text-align: center; background: var(--card); border: 1px solid var(--border);
      border-radius: 10px; padding: 20px 16px; position: relative;
    }
    .step-num {
      width: 36px; height: 36px; border-radius: 50%; background: var(--accent);
      color: #fff; font-weight: 800; font-size: 1rem; display: inline-flex;
      align-items: center; justify-content: center; margin-bottom: 10px;
    }
    .step-card h4 { font-size: 0.85rem; font-weight: 700; margin-bottom: 4px; }
    .step-card p { font-size: 0.78rem; color: var(--muted); margin: 0; }
    .step-arrow {
      position: absolute; right: -20px; top: 50%; transform: translateY(-50%);
      font-size: 1.2rem; color: #cbd5e1; z-index: 1;
    }
    .step-card:last-child .step-arrow { display: none; }

    /* Testimonial placeholders */
    .testimonial-card {
      background: #fafbfc; border: 1px solid var(--border); border-radius: 10px;
      padding: 20px; margin-bottom: 12px; position: relative;
    }
    .testimonial-card::before {
      content: '"'; position: absolute; top: 8px; left: 16px;
      font-size: 2rem; color: #cbd5e1; font-family: Georgia, serif;
    }
    .testimonial-card .tq { padding-left: 24px; font-size: 0.86rem; font-style: italic; color: #475569; line-height: 1.6; margin-bottom: 8px; }
    .testimonial-card .tauthor { font-size: 0.78rem; font-weight: 700; color: var(--text); padding-left: 24px; }

    /* What we handle */
    .handle-grid { display: grid; grid-template-columns: 1fr 1fr 1fr; gap: 12px; margin: 16px 0; }
    .handle-item {
      text-align: center; padding: 16px 12px; background: var(--accent-light);
      border-radius: 10px;
    }
    .handle-item .handle-icon { font-size: 1.6rem; margin-bottom: 6px; }
    .handle-item h4 { font-size: 0.8rem; font-weight: 700; color: var(--text); margin-bottom: 2px; }
    .handle-item p { font-size: 0.72rem; color: var(--muted); margin: 0; }

    /* Footer */
    .proposal-footer {
      text-align: center; padding: 30px 48px; background: var(--kande-navy);
      color: #cbd5e1; font-size: 0.78rem;
    }
    .proposal-footer strong { color: var(--kande-gold); }

    /* Print styles */
    @media print {
      body { background: #fff !important; }
      #kv-topnav, #kv-mobile-menu, #kv-overlay, .form-panel, .preview-toolbar, .page-header { display: none !important; }
      .kv-main-content { padding-top: 0 !important; }
      .page-wrapper { padding: 0 !important; max-width: none !important; }
      .panels { display: block !important; }
      .preview-panel { border: none !important; box-shadow: none !important; }
      .proposal-content .cover-page { min-height: 90vh; page-break-after: always; }
      .proposal-content .section { page-break-inside: avoid; }
      .compare-table { page-break-inside: avoid; }
      .revenue-card { page-break-inside: avoid; }
      .steps-row { page-break-inside: avoid; }
    }

    /* Responsive */
    @media (max-width: 1100px) {
      .panels { grid-template-columns: 1fr; }
      .form-panel { position: static; max-height: none; }
    }
    @media (max-width: 600px) {
      .advantage-grid { grid-template-columns: 1fr; }
      .handle-grid { grid-template-columns: 1fr 1fr; }
      .steps-row { flex-direction: column; }
      .step-arrow { display: none !important; }
      .proposal-content .section { padding: 24px 20px; }
      .proposal-content .cover-page { padding: 40px 20px; }
    }
  </style>
</head>
<body>
<script src="/nav.js"></script>
<div class="page-wrapper">
  <div class="page-header">
    <h1>üìë Proposal Generator</h1>
    <p>Create polished, professional proposals for property managers ‚Äî auto-tailored by property type.</p>
  </div>

  <div class="panels">
    <!-- LEFT: Input Form -->
    <div class="form-panel">
      <!-- Draft management -->
      <div class="drafts-bar">
        <select id="draftSelect" title="Saved drafts">
          <option value="">‚Äî New Proposal ‚Äî</option>
        </select>
        <button class="btn btn-sm btn-secondary" onclick="loadDraft()" title="Load draft">üìÇ</button>
        <button class="btn btn-sm btn-amber" onclick="saveDraft()" title="Save draft">üíæ</button>
        <button class="btn btn-sm btn-secondary" onclick="deleteDraft()" title="Delete draft" style="color:var(--red)">üóë</button>
      </div>

      <!-- Property Info -->
      <div class="form-section">
        <h3>üè¢ Property Information</h3>
        <div class="form-group">
          <label>Property / Business Name *</label>
          <input type="text" id="propertyName" placeholder="e.g. The Meridian at Green Valley" oninput="autoGenerate()">
        </div>
        <div class="form-group">
          <label>Address</label>
          <input type="text" id="propertyAddress" placeholder="e.g. 1234 Green Valley Pkwy, Henderson, NV 89052" oninput="autoGenerate()">
        </div>
        <div class="form-row">
          <div class="form-group">
            <label>Contact Name</label>
            <input type="text" id="contactName" placeholder="e.g. Sarah Johnson" oninput="autoGenerate()">
          </div>
          <div class="form-group">
            <label>Contact Title</label>
            <input type="text" id="contactTitle" placeholder="e.g. Property Manager" oninput="autoGenerate()">
          </div>
        </div>
        <div class="form-row">
          <div class="form-group">
            <label>Contact Email</label>
            <input type="email" id="contactEmail" placeholder="sarah@example.com" oninput="autoGenerate()">
          </div>
          <div class="form-group">
            <label>Contact Phone</label>
            <input type="tel" id="contactPhone" placeholder="(702) 555-0100" oninput="autoGenerate()">
          </div>
        </div>
      </div>

      <!-- Property Details -->
      <div class="form-section">
        <h3>üìä Property Details</h3>
        <div class="form-group">
          <label>Property Type *</label>
          <select id="propertyType" onchange="autoGenerate()">
            <option value="">Select type‚Ä¶</option>
            <option value="luxury_apartment">Luxury Apartment Community</option>
            <option value="apartment">Apartment Complex</option>
            <option value="senior_living">Senior Living / Assisted Living</option>
            <option value="office">Office Building</option>
            <option value="healthcare">Healthcare / Hospital</option>
            <option value="manufacturing">Manufacturing / Industrial</option>
            <option value="warehouse">Warehouse / Distribution Center</option>
            <option value="recreation">Recreation Center / YMCA</option>
            <option value="hotel">Hotel / Hospitality</option>
            <option value="education">Education / School</option>
            <option value="coworking">Co-Working Space</option>
            <option value="other">Other</option>
          </select>
        </div>
        <div class="form-row">
          <div class="form-group">
            <label>Estimated Units / Employees</label>
            <input type="number" id="unitCount" placeholder="e.g. 250" min="1" oninput="autoGenerate()">
            <div class="hint">Apartments: # units. Office/Industrial: # employees</div>
          </div>
          <div class="form-group">
            <label>Daily Foot Traffic</label>
            <input type="number" id="footTraffic" placeholder="e.g. 150" min="1" oninput="autoGenerate()">
            <div class="hint">Avg people passing by machine daily</div>
          </div>
        </div>
        <div class="form-row">
          <div class="form-group">
            <label>Machines Proposed</label>
            <input type="number" id="machineCount" value="1" min="1" max="10" oninput="autoGenerate()">
          </div>
          <div class="form-group">
            <label>Revenue Share %</label>
            <div class="slider-wrapper">
              <input type="range" id="revShareSlider" min="0" max="10" step="0.5" value="3" oninput="updateRevShare()">
              <span class="slider-value" id="revShareValue">3%</span>
            </div>
            <div class="hint">Industry standard: 3‚Äì5% (starting month 6)</div>
          </div>
        </div>
      </div>

      <!-- Custom Notes -->
      <div class="form-section">
        <h3>‚úèÔ∏è Custom Notes</h3>
        <div class="form-group">
          <label>Special Value Propositions</label>
          <textarea id="customNotes" placeholder="Any custom selling points, special arrangements, or notes for this property‚Ä¶" rows="3" oninput="autoGenerate()"></textarea>
        </div>
        <div class="form-group">
          <label>Proposed Placement Location</label>
          <input type="text" id="placementNote" placeholder="e.g. Lobby near mailboxes, break room, pool area" oninput="autoGenerate()">
        </div>
      </div>

      <!-- Actions -->
      <div class="btn-row">
        <button class="btn btn-primary" onclick="generateProposal()">üìë Generate Proposal</button>
        <button class="btn btn-secondary" onclick="resetForm()">üîÑ Reset</button>
      </div>
    </div>

    <!-- RIGHT: Preview Panel -->
    <div class="preview-panel">
      <div class="preview-toolbar">
        <div class="preview-toolbar-left">
          <span>üìÑ Proposal Preview</span>
        </div>
        <div class="preview-toolbar-right">
          <button class="btn btn-sm btn-secondary" onclick="printProposal()">üñ®Ô∏è Print</button>
          <button class="btn btn-sm btn-success" onclick="downloadProposal()">‚¨áÔ∏è Download HTML</button>
        </div>
      </div>
      <div id="proposalOutput">
        <div class="preview-empty">
          <div class="empty-icon">üìë</div>
          <h3>No Proposal Generated</h3>
          <p>Fill in the property details on the left and click "Generate Proposal" to create a professional proposal.</p>
        </div>
      </div>
    </div>
  </div>
</div>

<script>
/* ===== DATA MODELS ===== */
const PROPERTY_CONFIG = {
  luxury_apartment: {
    label: 'Luxury Apartment Community',
    productMix: 'Premium beverages (smart water, Celsius, cold brew coffee), gourmet snacks, protein bars, fresh grab-and-go meals, and everyday essentials (phone chargers, headphones, personal care items)',
    placement: 'lobby near mailboxes and package lockers, fitness center, pool/clubhouse area, or co-working lounge',
    sellingPoints: [
      'Adds a premium amenity that increases resident satisfaction and retention',
      'Attracts prospective residents during tours ‚Äî a visible lifestyle perk',
      'Residents can grab essentials without leaving the building',
      '$54/month average rent premium for properties with modern amenities (NAA study)'
    ],
    avgSpendPerPerson: 2.50,
    conversionRate: 0.08
  },
  apartment: {
    label: 'Apartment Complex',
    productMix: 'Popular sodas, energy drinks (Celsius, Red Bull), water, chips, candy bars, and essential convenience items',
    placement: 'main lobby, laundry room, or community room',
    sellingPoints: [
      'Zero-cost amenity that differentiates your property',
      'Residents love 24/7 access to snacks and drinks without driving',
      'Reduces complaints about lack of on-site services',
      'Revenue share provides passive income at zero effort'
    ],
    avgSpendPerPerson: 2.00,
    conversionRate: 0.07
  },
  senior_living: {
    label: 'Senior Living Community',
    productMix: 'Healthy snacks, sugar-free options, low-sodium choices, bottled water, easy-open packages, protein drinks, and comfort items',
    placement: 'common area near dining, activity room, or main lobby',
    sellingPoints: [
      'Gives residents independence and choice between meals',
      'Curated healthy and dietary-friendly product selection',
      'Accessible, intuitive touchscreen ‚Äî no complicated apps required',
      'Families appreciate the convenience during visits'
    ],
    avgSpendPerPerson: 1.80,
    conversionRate: 0.10
  },
  office: {
    label: 'Office Building',
    productMix: 'Premium coffee alternatives, sparkling water, protein bars, premium chips, healthy snack options, and energy drinks',
    placement: 'break room, lobby, or common area on highest-traffic floor',
    sellingPoints: [
      'Boosts employee satisfaction and reduces time leaving for snacks',
      'Premium, curated selection that reflects your workplace culture',
      'Data-driven restocking ensures favorites are always available',
      'Replaces outdated vending with modern, cashless smart technology'
    ],
    avgSpendPerPerson: 3.00,
    conversionRate: 0.12
  },
  healthcare: {
    label: 'Healthcare Facility',
    productMix: 'Healthy snacks, protein bars, nuts, fresh fruit cups, bottled water, low-sugar beverages, and comfort items for visitors',
    placement: 'staff break room, visitor waiting area, or ER waiting room',
    sellingPoints: [
      '24/7 availability matches healthcare shift schedules perfectly',
      'Healthy options align with your facility\'s wellness mission',
      'Staff and visitors get fresh food without leaving the building',
      'Contactless, hygienic purchasing ‚Äî critical in healthcare settings'
    ],
    avgSpendPerPerson: 2.80,
    conversionRate: 0.15
  },
  manufacturing: {
    label: 'Manufacturing Facility',
    productMix: 'Energy drinks, filling snacks, cold drinks, sandwiches, candy bars, chips, water, and protein-rich options for hard-working teams',
    placement: 'main break room and secondary break areas near production floor',
    sellingPoints: [
      'Keeps workers energized without leaving the facility',
      'Serves all shifts ‚Äî 24/7 automated, always stocked',
      'Bulk-friendly pricing for blue-collar budgets',
      'Reduces break time spent driving to convenience stores'
    ],
    avgSpendPerPerson: 3.20,
    conversionRate: 0.18
  },
  warehouse: {
    label: 'Warehouse / Distribution Center',
    productMix: 'Cold beverages, energy drinks, filling snacks, protein bars, water, Gatorade, and grab-and-go meals',
    placement: 'main break room, loading dock area break space, or near time clocks',
    sellingPoints: [
      '24/7 operations need 24/7 refreshment ‚Äî we provide both',
      'High-energy products matched to physically demanding work',
      'Recession-resistant location with consistent daily demand',
      'No management involvement needed ‚Äî we handle everything'
    ],
    avgSpendPerPerson: 3.00,
    conversionRate: 0.20
  },
  recreation: {
    label: 'Recreation Center / YMCA',
    productMix: 'Sports drinks, water, energy bars, healthy snacks, kids\' snack options, and grab-and-go items for families',
    placement: 'main lobby near entrance/exit, near courts/gym area, or spectator seating area',
    sellingPoints: [
      'Captive audience ‚Äî families stay 2-4 hours during events and tournaments',
      'Parents buy for kids; athletes buy post-workout',
      'Revenue from tournaments and special events can spike significantly',
      'Healthier alternatives to traditional concession stands'
    ],
    avgSpendPerPerson: 2.80,
    conversionRate: 0.15
  },
  hotel: {
    label: 'Hotel / Hospitality',
    productMix: 'Premium beverages, snacks, toiletry essentials, phone chargers, and convenience items guests forget to pack',
    placement: 'lobby, near elevators on guest floors, pool area, or fitness center',
    sellingPoints: [
      'Adds a modern amenity guests expect in quality hotels',
      '24/7 availability ‚Äî no front desk staffing needed for snacks',
      'Higher-margin convenience items (chargers, toiletries) boost revenue',
      'Reduces guest complaints about limited food options after hours'
    ],
    avgSpendPerPerson: 3.50,
    conversionRate: 0.10
  },
  education: {
    label: 'School / Educational Facility',
    productMix: 'Student-friendly snacks, drinks, healthy options, quick meals, and energy drinks (if permitted)',
    placement: 'student commons, cafeteria overflow area, teacher\'s lounge, or near gymnasium',
    sellingPoints: [
      'Captive audience of students and staff with consistent demand',
      'Healthy options support school wellness initiatives',
      'Revenue share can fund school programs or activities',
      'Cashless technology ‚Äî no cash handling concerns'
    ],
    avgSpendPerPerson: 2.00,
    conversionRate: 0.12
  },
  coworking: {
    label: 'Co-Working Space',
    productMix: 'Cold brew, premium beverages, energy drinks, protein snacks, premium chips, fresh items, and tech accessories',
    placement: 'kitchen/pantry area, main communal space, or near meeting rooms',
    sellingPoints: [
      'Enhances the member experience and justifies membership pricing',
      'Professionals expect premium, curated food and beverage options',
      'Smart technology fits the innovative, tech-forward coworking brand',
      'No staff time required ‚Äî fully automated and self-managing'
    ],
    avgSpendPerPerson: 3.50,
    conversionRate: 0.14
  },
  other: {
    label: 'Commercial Property',
    productMix: 'A curated selection of popular beverages, snacks, and convenience items tailored to your specific audience',
    placement: 'high-traffic common area with power outlet and Wi-Fi connectivity',
    sellingPoints: [
      'Zero cost to your property ‚Äî we provide, stock, and maintain everything',
      'Modern, cashless technology that impresses visitors and tenants',
      'Data-driven product selection ensures we stock what people actually buy',
      'Revenue share provides passive income with zero effort'
    ],
    avgSpendPerPerson: 2.50,
    conversionRate: 0.10
  }
};

/* ===== REVENUE CALCULATIONS ===== */
function calcRevenue(unitCount, footTraffic, machineCount, revShare, propertyType) {
  const config = PROPERTY_CONFIG[propertyType] || PROPERTY_CONFIG.other;
  const dailyTraffic = footTraffic || Math.round((unitCount || 100) * 0.6);
  const dailyTransactions = Math.round(dailyTraffic * config.conversionRate * machineCount);
  const dailyRevenue = dailyTransactions * config.avgSpendPerPerson;
  const monthlyRevenue = Math.round(dailyRevenue * 30);
  const annualRevenue = monthlyRevenue * 12;
  const monthlyRevShareAmount = Math.round(monthlyRevenue * (revShare / 100));
  const annualRevShareAmount = monthlyRevShareAmount * 12;
  return {
    dailyTraffic, dailyTransactions, dailyRevenue: Math.round(dailyRevenue),
    monthlyRevenue, annualRevenue,
    monthlyRevShareAmount, annualRevShareAmount,
    avgSpend: config.avgSpendPerPerson
  };
}

/* ===== FORM HELPERS ===== */
function updateRevShare() {
  const val = document.getElementById('revShareSlider').value;
  document.getElementById('revShareValue').textContent = val + '%';
  autoGenerate();
}

function getFormData() {
  return {
    propertyName: document.getElementById('propertyName').value.trim(),
    propertyAddress: document.getElementById('propertyAddress').value.trim(),
    contactName: document.getElementById('contactName').value.trim(),
    contactTitle: document.getElementById('contactTitle').value.trim(),
    contactEmail: document.getElementById('contactEmail').value.trim(),
    contactPhone: document.getElementById('contactPhone').value.trim(),
    propertyType: document.getElementById('propertyType').value,
    unitCount: parseInt(document.getElementById('unitCount').value) || 0,
    footTraffic: parseInt(document.getElementById('footTraffic').value) || 0,
    machineCount: parseInt(document.getElementById('machineCount').value) || 1,
    revShare: parseFloat(document.getElementById('revShareSlider').value) || 3,
    customNotes: document.getElementById('customNotes').value.trim(),
    placementNote: document.getElementById('placementNote').value.trim()
  };
}

function setFormData(data) {
  document.getElementById('propertyName').value = data.propertyName || '';
  document.getElementById('propertyAddress').value = data.propertyAddress || '';
  document.getElementById('contactName').value = data.contactName || '';
  document.getElementById('contactTitle').value = data.contactTitle || '';
  document.getElementById('contactEmail').value = data.contactEmail || '';
  document.getElementById('contactPhone').value = data.contactPhone || '';
  document.getElementById('propertyType').value = data.propertyType || '';
  document.getElementById('unitCount').value = data.unitCount || '';
  document.getElementById('footTraffic').value = data.footTraffic || '';
  document.getElementById('machineCount').value = data.machineCount || 1;
  document.getElementById('revShareSlider').value = data.revShare || 3;
  document.getElementById('revShareValue').textContent = (data.revShare || 3) + '%';
  document.getElementById('customNotes').value = data.customNotes || '';
  document.getElementById('placementNote').value = data.placementNote || '';
}

function resetForm() {
  document.querySelectorAll('.form-panel input, .form-panel textarea').forEach(el => {
    if (el.type === 'range') el.value = 3;
    else if (el.type === 'number' && el.id === 'machineCount') el.value = 1;
    else el.value = '';
  });
  document.getElementById('propertyType').value = '';
  document.getElementById('revShareValue').textContent = '3%';
  document.getElementById('proposalOutput').innerHTML = `
    <div class="preview-empty">
      <div class="empty-icon">üìë</div>
      <h3>No Proposal Generated</h3>
      <p>Fill in the property details on the left and click "Generate Proposal" to create a professional proposal.</p>
    </div>`;
}

/* ===== AUTO-GENERATE (debounced) ===== */
let autoTimer = null;
function autoGenerate() {
  clearTimeout(autoTimer);
  autoTimer = setTimeout(() => {
    const d = getFormData();
    if (d.propertyName && d.propertyType) generateProposal();
  }, 600);
}

/* ===== GENERATE PROPOSAL ===== */
function generateProposal() {
  const d = getFormData();
  if (!d.propertyName) return alert('Please enter a property name.');
  if (!d.propertyType) return alert('Please select a property type.');

  const config = PROPERTY_CONFIG[d.propertyType] || PROPERTY_CONFIG.other;
  const rev = calcRevenue(d.unitCount, d.footTraffic, d.machineCount, d.revShare, d.propertyType);
  const today = new Date().toLocaleDateString('en-US', { year: 'numeric', month: 'long', day: 'numeric' });
  const placement = d.placementNote || config.placement;
  const machineWord = d.machineCount === 1 ? 'machine' : 'machines';
  const unitLabel = ['luxury_apartment','apartment','senior_living'].includes(d.propertyType) ? 'units' : 'employees';

  let html = `<div class="proposal-content">`;

  /* ‚îÄ‚îÄ COVER PAGE ‚îÄ‚îÄ */
  html += `
    <div class="cover-page">
      <img class="cover-logo" src="/logo.png" alt="Kande VendTech" onerror="this.style.display='none'">
      <div class="cover-title">Kande VendTech</div>
      <div class="cover-tagline">Smart Refreshment Solutions</div>
      <div class="cover-divider"></div>
      <div class="cover-for">Prepared For</div>
      <div class="cover-property">${esc(d.propertyName)}</div>
      ${d.propertyAddress ? `<div class="cover-address">${esc(d.propertyAddress)}</div>` : ''}
      ${d.contactName ? `<div class="cover-address" style="margin-top:8px">${esc(d.contactName)}${d.contactTitle ? ', ' + esc(d.contactTitle) : ''}</div>` : ''}
      <div class="cover-date">${today}</div>
    </div>`;

  /* ‚îÄ‚îÄ SECTION 1: About Kande VendTech ‚îÄ‚îÄ */
  html += `
    <div class="section">
      <div class="section-title"><span class="sec-num">1</span> About Kande VendTech</div>
      <p>Kande VendTech is a Henderson-based smart refreshment company serving the Las Vegas metropolitan area. We deploy <strong>AI-powered smart coolers</strong> that combine the convenience of a vending machine with the intelligence of a modern retail platform.</p>
      <p>Unlike traditional vending companies, our technology uses <strong>computer vision and weight sensors</strong> to automatically detect what's been taken ‚Äî no buttons to press, no selections to make. Customers simply open the door, grab what they want, and close it. Payment is processed automatically through their phone or card.</p>
      <p>Our AI-powered inventory system tracks every product in real time, predicting when restocking is needed and learning which products are most popular at your specific location. This means <strong>fresher products, fewer empty slots, and a selection that continuously improves</strong> based on what your ${unitLabel === 'units' ? 'residents' : 'people'} actually want.</p>
      <p>As a <strong>locally owned and operated</strong> company, you won't deal with a call center or corporate bureaucracy. You get one phone number ‚Äî and the owner picks up.</p>
    </div>`;

  /* ‚îÄ‚îÄ SECTION 2: Why Smart Vending? ‚îÄ‚îÄ */
  html += `
    <div class="section">
      <div class="section-title"><span class="sec-num">2</span> Why Smart Vending?</div>
      <p>The refreshment industry has evolved dramatically. Traditional vending machines with coin slots and spiral dispensers are being replaced by intelligent, data-driven solutions. Here's how they compare:</p>
      <table class="compare-table">
        <thead>
          <tr>
            <th>Feature</th>
            <th>Traditional Vending</th>
            <th class="highlight-col">Kande Smart Cooler</th>
          </tr>
        </thead>
        <tbody>
          <tr><td>Payment</td><td>Cash + outdated card readers</td><td class="highlight-col"><span class="check">‚úì</span> Contactless tap, Apple/Google Pay, app</td></tr>
          <tr><td>Product Selection</td><td>Whatever the vendor loads</td><td class="highlight-col"><span class="check">‚úì</span> AI-optimized based on real purchase data</td></tr>
          <tr><td>Freshness</td><td>Products often expire on shelf</td><td class="highlight-col"><span class="check">‚úì</span> Real-time expiry tracking, automatic rotation</td></tr>
          <tr><td>Restocking</td><td>Fixed schedule (weekly/biweekly)</td><td class="highlight-col"><span class="check">‚úì</span> Smart alerts ‚Äî restocked when needed</td></tr>
          <tr><td>Product Stuck?</td><td>Common ‚Äî lose money, no recourse</td><td class="highlight-col"><span class="check">‚úì</span> No spirals ‚Äî grab & go, never jams</td></tr>
          <tr><td>Reporting</td><td>None or paper-based</td><td class="highlight-col"><span class="check">‚úì</span> Real-time dashboard with sales data</td></tr>
          <tr><td>Look & Feel</td><td>Bulky, dated, industrial</td><td class="highlight-col"><span class="check">‚úì</span> Sleek, modern, glass-front cooler design</td></tr>
          <tr><td>Maintenance</td><td>Reactive ‚Äî call when it breaks</td><td class="highlight-col"><span class="check">‚úì</span> Remote diagnostics, proactive service</td></tr>
        </tbody>
      </table>
    </div>`;

  /* ‚îÄ‚îÄ SECTION 3: Proposed Solution ‚îÄ‚îÄ */
  html += `
    <div class="section">
      <div class="section-title"><span class="sec-num">3</span> Proposed Solution for ${esc(d.propertyName)}</div>
      <p>Based on your ${config.label.toLowerCase()} with ${d.unitCount ? d.unitCount.toLocaleString() + ' ' + unitLabel : 'your current traffic volume'}, we recommend the following setup:</p>
      <ul>
        <li><strong>${d.machineCount} SandStar AI Smart Cooler${d.machineCount > 1 ? 's' : ''}</strong> ‚Äî glass-front, LED-lit, AI-powered inventory tracking, contactless payment</li>
        <li><strong>Product Mix:</strong> ${config.productMix}</li>
        <li><strong>Suggested Placement:</strong> ${esc(placement)}</li>
        ${d.machineCount > 1 ? `<li><strong>Coverage:</strong> ${d.machineCount} ${machineWord} strategically positioned to maximize accessibility and minimize travel for your ${unitLabel === 'units' ? 'residents' : 'team'}</li>` : ''}
      </ul>
      <p>Our product selection is tailored specifically for ${config.label.toLowerCase()} environments. We use data from similar locations to pre-load the most popular items, then our AI continuously optimizes based on actual purchase patterns at your location.</p>
      ${config.sellingPoints.map(s => `<p>‚ú¶ ${s}</p>`).join('')}
      ${d.customNotes ? `<p style="margin-top:16px; padding:12px 16px; background:var(--amber-light); border-radius:8px; font-size:0.84rem;"><strong>Additional Notes:</strong> ${esc(d.customNotes)}</p>` : ''}
    </div>`;

  /* ‚îÄ‚îÄ SECTION 4: Revenue Projections ‚îÄ‚îÄ */
  html += `
    <div class="section">
      <div class="section-title"><span class="sec-num">4</span> Revenue Projections</div>
      <p>Based on industry benchmarks for ${config.label.toLowerCase()} locations with ${d.unitCount ? d.unitCount.toLocaleString() + ' ' + unitLabel : 'comparable traffic'} and ${d.machineCount} ${machineWord}:</p>
      <div class="revenue-card">
        <div class="revenue-row">
          <span class="revenue-label">Estimated Daily Traffic</span>
          <span class="revenue-value">${rev.dailyTraffic.toLocaleString()} people</span>
        </div>
        <div class="revenue-row">
          <span class="revenue-label">Estimated Daily Transactions</span>
          <span class="revenue-value">${rev.dailyTransactions.toLocaleString()}</span>
        </div>
        <div class="revenue-row">
          <span class="revenue-label">Average Transaction Value</span>
          <span class="revenue-value">$${rev.avgSpend.toFixed(2)}</span>
        </div>
        <div class="revenue-row">
          <span class="revenue-label">Estimated Monthly Revenue</span>
          <span class="revenue-value">$${rev.monthlyRevenue.toLocaleString()}</span>
        </div>
        <div class="revenue-row">
          <span class="revenue-label">Estimated Annual Revenue</span>
          <span class="revenue-value revenue-total">$${rev.annualRevenue.toLocaleString()}</span>
        </div>
        ${d.revShare > 0 ? `
        <div class="revenue-row" style="margin-top:12px; padding-top:12px; border-top:2px solid #86efac;">
          <span class="revenue-label"><strong>Your Revenue Share (${d.revShare}%)</strong></span>
          <span class="revenue-value" style="color:#15803d;">$${rev.monthlyRevShareAmount.toLocaleString()}/mo ‚Äî $${rev.annualRevShareAmount.toLocaleString()}/yr</span>
        </div>` : ''}
      </div>
      <p class="revenue-note">* Projections are estimates based on industry data for similar ${config.label.toLowerCase()} locations. Actual results may vary based on placement, product mix, and seasonal factors.${d.revShare > 0 ? ' Revenue share begins after the initial 6-month launch period.' : ''}</p>
    </div>`;

  /* ‚îÄ‚îÄ SECTION 5: Our Competitive Advantage ‚îÄ‚îÄ */
  html += `
    <div class="section">
      <div class="section-title"><span class="sec-num">5</span> Our Competitive Advantage</div>
      <p>The Las Vegas vending market has many operators ‚Äî but very few offer what we do. Here's what makes Kande VendTech different:</p>
      <div class="advantage-grid">
        <div class="advantage-card">
          <div class="advantage-icon">üè†</div>
          <div>
            <h4>Locally Owned & Operated</h4>
            <p>We're Henderson-based, not a franchise or corporate call center. When you call, the owner answers.</p>
          </div>
        </div>
        <div class="advantage-card">
          <div class="advantage-icon">ü§ñ</div>
          <div>
            <h4>AI-Powered Smart Technology</h4>
            <p>Computer vision, weight sensors, and real-time analytics. Most competitors still use 20-year-old spiral machines.</p>
          </div>
        </div>
        <div class="advantage-card">
          <div class="advantage-icon">üí∞</div>
          <div>
            <h4>Revenue Share Included</h4>
            <p>Most local competitors offer 0% commission. We share ${d.revShare}% of revenue because we believe in partnerships, not just placements.</p>
          </div>
        </div>
        <div class="advantage-card">
          <div class="advantage-icon">üìä</div>
          <div>
            <h4>Data-Driven Restocking</h4>
            <p>Our AI predicts demand, tracks inventory, and ensures your machine is never empty or stale. No more "hope and check" schedules.</p>
          </div>
        </div>
        <div class="advantage-card">
          <div class="advantage-icon">üí≥</div>
          <div>
            <h4>100% Cashless & Contactless</h4>
            <p>Apple Pay, Google Pay, tap-to-pay cards. Secure, fast, and hygienic ‚Äî no cash handling, no coin jams.</p>
          </div>
        </div>
        <div class="advantage-card">
          <div class="advantage-icon">‚ö°</div>
          <div>
            <h4>Rapid Response Service</h4>
            <p>Issues are often detected remotely before anyone notices. When on-site service is needed, we're same-day in Henderson.</p>
          </div>
        </div>
      </div>
    </div>`;

  /* ‚îÄ‚îÄ SECTION 6: What We Handle ‚îÄ‚îÄ */
  html += `
    <div class="section">
      <div class="section-title"><span class="sec-num">6</span> What We Handle ‚Äî At Zero Cost to You</div>
      <p>We provide a true <strong>full-service, zero-cost partnership</strong>. There is absolutely no financial commitment required from ${esc(d.propertyName)}.</p>
      <div class="handle-grid">
        <div class="handle-item">
          <div class="handle-icon">üì¶</div>
          <h4>Equipment</h4>
          <p>We provide the machine ‚Äî no purchase, lease, or deposit required</p>
        </div>
        <div class="handle-item">
          <div class="handle-icon">üîß</div>
          <h4>Installation</h4>
          <p>Professional setup, configured and tested before we leave</p>
        </div>
        <div class="handle-item">
          <div class="handle-icon">üõí</div>
          <h4>Product Sourcing</h4>
          <p>We purchase, curate, and price all inventory</p>
        </div>
        <div class="handle-item">
          <div class="handle-icon">üîÑ</div>
          <h4>Restocking</h4>
          <p>Regular visits to keep the machine full and fresh</p>
        </div>
        <div class="handle-item">
          <div class="handle-icon">üõ†Ô∏è</div>
          <h4>Maintenance</h4>
          <p>Cleaning, repairs, and technical support ‚Äî all covered</p>
        </div>
        <div class="handle-item">
          <div class="handle-icon">üìà</div>
          <h4>Optimization</h4>
          <p>Ongoing product mix adjustments based on sales data</p>
        </div>
      </div>
      <p style="text-align:center; font-weight:700; color:var(--green); margin-top:16px; font-size:0.92rem;">Your only requirement: an accessible location with a standard power outlet and Wi-Fi access.</p>
    </div>`;

  /* ‚îÄ‚îÄ SECTION 7: Next Steps ‚îÄ‚îÄ */
  html += `
    <div class="section">
      <div class="section-title"><span class="sec-num">7</span> Next Steps ‚Äî Getting Started Is Simple</div>
      <p>We've designed our onboarding process to be as easy as possible. Three simple steps:</p>
      <div class="steps-row">
        <div class="step-card">
          <div class="step-num">1</div>
          <h4>Sign Agreement</h4>
          <p>A simple placement agreement ‚Äî no complex contracts, no hidden fees.</p>
          <span class="step-arrow">‚Üí</span>
        </div>
        <div class="step-card">
          <div class="step-num">2</div>
          <h4>We Install</h4>
          <p>We deliver, set up, and stock your smart cooler at a time that works for you.</p>
          <span class="step-arrow">‚Üí</span>
        </div>
        <div class="step-card">
          <div class="step-num">3</div>
          <h4>You Earn</h4>
          <p>Your ${unitLabel === 'units' ? 'residents' : 'team'} enjoy refreshments and you earn revenue share ‚Äî hands-free.</p>
        </div>
      </div>
      <p style="text-align:center; margin-top:20px;">Installation typically takes place <strong>within 2 weeks</strong> of signing. We handle all logistics.</p>
    </div>`;

  /* ‚îÄ‚îÄ SECTION 8: Testimonials / Case Studies ‚îÄ‚îÄ */
  html += `
    <div class="section">
      <div class="section-title"><span class="sec-num">8</span> What Our Partners Say</div>
      <div class="testimonial-card">
        <div class="tq">The smart cooler has been a hit with our residents. It's always stocked with exactly what they want, and we love that it's completely hands-off for our team. The revenue share is just a bonus.</div>
        <div class="tauthor">‚Äî Property Manager, Luxury Apartment Community</div>
      </div>
      <div class="testimonial-card">
        <div class="tq">We replaced our old vending machines with Kande's smart coolers and the difference is night and day. Better products, better technology, and actual customer service when we need it.</div>
        <div class="tauthor">‚Äî Operations Director, Manufacturing Facility</div>
      </div>
      <p style="font-size:0.78rem; color:var(--muted); text-align:center; margin-top:12px; font-style:italic;">Additional references and site visits available upon request.</p>
    </div>`;

  /* ‚îÄ‚îÄ FOOTER ‚îÄ‚îÄ */
  html += `
    <div class="proposal-footer">
      <strong>Kande VendTech</strong> ‚Äî Smart Refreshment Solutions<br>
      Henderson, Nevada &nbsp;‚Ä¢&nbsp; kandevendtech.com &nbsp;‚Ä¢&nbsp; kurtis@kandevendtech.com<br><br>
      This proposal is valid for 30 days from the date above.<br>
      <span style="font-size:0.7rem; color:#64748b;">Confidential ‚Äî prepared exclusively for ${esc(d.propertyName)}</span>
    </div>`;

  html += `</div>`;
  document.getElementById('proposalOutput').innerHTML = html;
}

function esc(str) {
  if (!str) return '';
  const d = document.createElement('div');
  d.textContent = str;
  return d.innerHTML;
}

/* ===== PRINT ===== */
function printProposal() {
  if (!document.querySelector('.proposal-content')) return alert('Generate a proposal first.');
  window.print();
}

/* ===== DOWNLOAD AS STANDALONE HTML ===== */
function downloadProposal() {
  const content = document.querySelector('.proposal-content');
  if (!content) return alert('Generate a proposal first.');

  const d = getFormData();
  const styles = document.querySelector('style').textContent;
  const standalone = `<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Proposal ‚Äî ${esc(d.propertyName)} ‚Äî Kande VendTech</title>
  <style>
    * { margin: 0; padding: 0; box-sizing: border-box; }
    :root {
      --bg: #ffffff; --card: #ffffff; --border: #e2e8f0; --text: #0f172a;
      --muted: #64748b; --accent: #3b82f6; --accent-light: #eff6ff;
      --green: #22c55e; --green-light: #f0fdf4;
      --amber: #f59e0b; --amber-light: #fffbeb;
      --red: #ef4444; --red-light: #fef2f2;
      --purple: #8b5cf6; --purple-light: #f5f3ff;
      --teal: #14b8a6; --teal-light: #f0fdfa;
      --radius: 12px;
      --kande-navy: #1e293b;
      --kande-gold: #d4a843;
    }
    body { font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif; background: #fff; color: var(--text); }
    .proposal-content .cover-page {
      text-align: center; padding: 80px 48px 60px;
      background: linear-gradient(135deg, var(--kande-navy) 0%, #334155 100%);
      color: #fff; min-height: 500px; display: flex; flex-direction: column;
      justify-content: center; align-items: center;
    }
    .cover-logo { width: 90px; height: 90px; border-radius: 16px; margin-bottom: 20px; border: 3px solid var(--kande-gold); box-shadow: 0 4px 20px rgba(0,0,0,0.3); }
    .cover-title { font-size: 2rem; font-weight: 800; letter-spacing: -0.5px; margin-bottom: 6px; }
    .cover-tagline { font-size: 1rem; color: var(--kande-gold); font-weight: 600; margin-bottom: 40px; letter-spacing: 1px; text-transform: uppercase; }
    .cover-divider { width: 80px; height: 3px; background: var(--kande-gold); margin: 0 auto 40px; border-radius: 2px; }
    .cover-for { font-size: 0.85rem; text-transform: uppercase; letter-spacing: 2px; color: #94a3b8; margin-bottom: 8px; }
    .cover-property { font-size: 1.5rem; font-weight: 700; margin-bottom: 4px; }
    .cover-address { font-size: 0.9rem; color: #cbd5e1; }
    .cover-date { margin-top: 40px; font-size: 0.8rem; color: #64748b; text-transform: uppercase; letter-spacing: 1px; }
    .section { padding: 36px 48px; border-bottom: 1px solid #f1f5f9; }
    .section:last-child { border-bottom: none; }
    .section-title { font-size: 1.15rem; font-weight: 800; color: var(--kande-navy); margin-bottom: 16px; display: flex; align-items: center; gap: 10px; }
    .section-title .sec-num { background: var(--kande-navy); color: var(--kande-gold); width: 28px; height: 28px; border-radius: 50%; display: inline-flex; align-items: center; justify-content: center; font-size: 0.75rem; font-weight: 800; flex-shrink: 0; }
    p { margin-bottom: 12px; font-size: 0.88rem; line-height: 1.7; color: #334155; }
    ul { margin: 0 0 12px 20px; }
    li { margin-bottom: 6px; font-size: 0.86rem; line-height: 1.6; color: #334155; }
    .compare-table { width: 100%; border-collapse: collapse; margin: 16px 0; font-size: 0.82rem; }
    .compare-table th { text-align: left; padding: 10px 14px; font-weight: 700; border-bottom: 2px solid var(--kande-navy); color: var(--kande-navy); font-size: 0.75rem; text-transform: uppercase; letter-spacing: 0.5px; }
    .compare-table td { padding: 10px 14px; border-bottom: 1px solid #f1f5f9; }
    .compare-table .check { color: var(--green); font-weight: 700; }
    .compare-table .highlight-col { background: var(--green-light); }
    .revenue-card { background: linear-gradient(135deg, var(--green-light) 0%, #ecfdf5 100%); border: 1px solid #bbf7d0; border-radius: 10px; padding: 24px; margin: 16px 0; }
    .revenue-row { display: flex; justify-content: space-between; align-items: center; padding: 8px 0; }
    .revenue-row + .revenue-row { border-top: 1px solid #bbf7d0; }
    .revenue-label { font-size: 0.84rem; color: #166534; font-weight: 500; }
    .revenue-value { font-size: 1.1rem; color: #166534; font-weight: 800; }
    .revenue-total { font-size: 1.3rem; }
    .revenue-note { font-size: 0.75rem; color: #16a34a; margin-top: 12px; font-style: italic; }
    .advantage-grid { display: grid; grid-template-columns: 1fr 1fr; gap: 12px; margin: 16px 0; }
    .advantage-card { background: #fff; border: 1px solid var(--border); border-radius: 10px; padding: 16px; display: flex; gap: 12px; align-items: flex-start; }
    .advantage-icon { font-size: 1.4rem; width: 36px; height: 36px; border-radius: 8px; display: flex; align-items: center; justify-content: center; flex-shrink: 0; background: var(--accent-light); }
    .advantage-card h4 { font-size: 0.82rem; font-weight: 700; margin-bottom: 4px; }
    .advantage-card p { font-size: 0.76rem; line-height: 1.5; color: var(--muted); margin: 0; }
    .handle-grid { display: grid; grid-template-columns: 1fr 1fr 1fr; gap: 12px; margin: 16px 0; }
    .handle-item { text-align: center; padding: 16px 12px; background: var(--accent-light); border-radius: 10px; }
    .handle-item .handle-icon { font-size: 1.6rem; margin-bottom: 6px; }
    .handle-item h4 { font-size: 0.8rem; font-weight: 700; color: var(--text); margin-bottom: 2px; }
    .handle-item p { font-size: 0.72rem; color: var(--muted); margin: 0; }
    .steps-row { display: flex; gap: 16px; margin: 20px 0; }
    .step-card { flex: 1; text-align: center; background: var(--card); border: 1px solid var(--border); border-radius: 10px; padding: 20px 16px; position: relative; }
    .step-num { width: 36px; height: 36px; border-radius: 50%; background: var(--accent); color: #fff; font-weight: 800; font-size: 1rem; display: inline-flex; align-items: center; justify-content: center; margin-bottom: 10px; }
    .step-card h4 { font-size: 0.85rem; font-weight: 700; margin-bottom: 4px; }
    .step-card p { font-size: 0.78rem; color: var(--muted); margin: 0; }
    .step-arrow { position: absolute; right: -20px; top: 50%; transform: translateY(-50%); font-size: 1.2rem; color: #cbd5e1; z-index: 1; }
    .step-card:last-child .step-arrow { display: none; }
    .testimonial-card { background: #fafbfc; border: 1px solid var(--border); border-radius: 10px; padding: 20px; margin-bottom: 12px; position: relative; }
    .testimonial-card::before { content: '"'; position: absolute; top: 8px; left: 16px; font-size: 2rem; color: #cbd5e1; font-family: Georgia, serif; }
    .testimonial-card .tq { padding-left: 24px; font-size: 0.86rem; font-style: italic; color: #475569; line-height: 1.6; margin-bottom: 8px; }
    .testimonial-card .tauthor { font-size: 0.78rem; font-weight: 700; color: var(--text); padding-left: 24px; }
    .proposal-footer { text-align: center; padding: 30px 48px; background: var(--kande-navy); color: #cbd5e1; font-size: 0.78rem; }
    .proposal-footer strong { color: var(--kande-gold); }
    @media print {
      .cover-page { min-height: 90vh; page-break-after: always; }
      .section { page-break-inside: avoid; }
    }
    @media (max-width: 600px) {
      .advantage-grid { grid-template-columns: 1fr; }
      .handle-grid { grid-template-columns: 1fr 1fr; }
      .steps-row { flex-direction: column; }
      .step-arrow { display: none !important; }
      .section { padding: 24px 20px; }
      .cover-page { padding: 40px 20px; }
    }
  </style>
</head>
<body>
${content.outerHTML}
</body>
</html>`;

  const blob = new Blob([standalone], { type: 'text/html' });
  const url = URL.createObjectURL(blob);
  const a = document.createElement('a');
  a.href = url;
  a.download = `Proposal-${d.propertyName.replace(/[^a-zA-Z0-9]/g, '-')}-${new Date().toISOString().split('T')[0]}.html`;
  a.click();
  URL.revokeObjectURL(url);
}

/* ===== DRAFT MANAGEMENT (localStorage) ===== */
const DRAFT_KEY = 'kv_proposal_drafts';

function getDrafts() {
  try { return JSON.parse(localStorage.getItem(DRAFT_KEY) || '{}'); } catch { return {}; }
}

function refreshDraftList() {
  const drafts = getDrafts();
  const sel = document.getElementById('draftSelect');
  sel.innerHTML = '<option value="">‚Äî New Proposal ‚Äî</option>';
  Object.keys(drafts).sort((a, b) => b.localeCompare(a)).forEach(key => {
    const opt = document.createElement('option');
    opt.value = key;
    opt.textContent = drafts[key].propertyName + ' (' + key.split('_')[0] + ')';
    sel.appendChild(opt);
  });
}

function saveDraft() {
  const d = getFormData();
  if (!d.propertyName) return alert('Enter a property name before saving.');
  const drafts = getDrafts();
  const key = new Date().toISOString().split('T')[0] + '_' + d.propertyName.replace(/[^a-zA-Z0-9]/g, '_').substring(0, 30);
  drafts[key] = d;
  localStorage.setItem(DRAFT_KEY, JSON.stringify(drafts));
  refreshDraftList();
  document.getElementById('draftSelect').value = key;
  showToast('Draft saved!');
}

function loadDraft() {
  const key = document.getElementById('draftSelect').value;
  if (!key) return resetForm();
  const drafts = getDrafts();
  if (!drafts[key]) return;
  setFormData(drafts[key]);
  generateProposal();
  showToast('Draft loaded.');
}

function deleteDraft() {
  const key = document.getElementById('draftSelect').value;
  if (!key) return alert('Select a draft to delete.');
  if (!confirm('Delete this draft?')) return;
  const drafts = getDrafts();
  delete drafts[key];
  localStorage.setItem(DRAFT_KEY, JSON.stringify(drafts));
  refreshDraftList();
  showToast('Draft deleted.');
}

function showToast(msg) {
  const t = document.createElement('div');
  t.textContent = msg;
  t.style.cssText = 'position:fixed;bottom:20px;right:20px;background:#1e293b;color:#fff;padding:10px 20px;border-radius:8px;font-size:0.85rem;font-weight:600;z-index:99999;box-shadow:0 4px 12px rgba(0,0,0,0.2);animation:fadeIn 0.2s ease-out;';
  document.body.appendChild(t);
  setTimeout(() => { t.style.opacity = '0'; t.style.transition = 'opacity 0.3s'; setTimeout(() => t.remove(), 300); }, 2000);
}

/* ===== INIT ===== */
refreshDraftList();
</script>
</body>
</html>
