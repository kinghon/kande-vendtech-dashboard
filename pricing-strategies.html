<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Pricing Strategies | Kande VendTech</title>
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">
  <script src="https://cdn.jsdelivr.net/npm/chart.js@4.4.0/dist/chart.umd.min.js"></script>
  <style>
    :root {
      --primary: #3b82f6;
      --primary-dark: #2563eb;
      --primary-light: #eff6ff;
      --success: #22c55e;
      --success-light: #dcfce7;
      --warning: #f59e0b;
      --warning-light: #fef3c7;
      --danger: #ef4444;
      --danger-light: #fee2e2;
      --purple: #8b5cf6;
      --purple-light: #ede9fe;
      --gray-50: #f8fafc;
      --gray-100: #f1f5f9;
      --gray-200: #e2e8f0;
      --gray-300: #cbd5e1;
      --gray-400: #94a3b8;
      --gray-500: #64748b;
      --gray-600: #475569;
      --gray-700: #334155;
      --gray-800: #1e293b;
      --gray-900: #0f172a;
    }
    
    * { margin: 0; padding: 0; box-sizing: border-box; }
    
    body {
      font-family: 'Inter', -apple-system, BlinkMacSystemFont, sans-serif;
      background: var(--gray-50);
      color: var(--gray-800);
      line-height: 1.5;
    }
    
    /* ===== Page Header ===== */
    .page-header {
      background: white;
      border-bottom: 1px solid var(--gray-200);
      padding: 20px 24px;
      margin-bottom: 24px;
    }
    
    .page-header-content {
      display: flex;
      justify-content: space-between;
      align-items: center;
      flex-wrap: wrap;
      gap: 16px;
    }
    
    .page-title {
      font-size: 1.5rem;
      font-weight: 700;
      color: var(--gray-900);
      margin: 0;
    }
    
    .page-subtitle {
      color: var(--gray-500);
      font-size: 0.875rem;
      margin-top: 4px;
    }
    
    .header-actions {
      display: flex;
      gap: 12px;
    }
    
    .container-fluid {
      padding: 0 24px 24px;
      max-width: 1600px;
      margin: 0 auto;
    }
    
    /* ===== Buttons ===== */
    .btn {
      display: inline-flex;
      align-items: center;
      gap: 8px;
      padding: 10px 18px;
      border-radius: 8px;
      font-size: 0.875rem;
      font-weight: 600;
      cursor: pointer;
      transition: all 0.15s;
      border: none;
    }
    
    .btn-primary {
      background: var(--primary);
      color: white;
    }
    
    .btn-primary:hover {
      background: var(--primary-dark);
    }
    
    .btn-secondary {
      background: white;
      color: var(--gray-700);
      border: 1px solid var(--gray-200);
    }
    
    .btn-secondary:hover {
      background: var(--gray-50);
      border-color: var(--gray-300);
    }
    
    .btn-success {
      background: var(--success);
      color: white;
    }
    
    .btn-success:hover {
      background: #16a34a;
    }
    
    .btn-icon {
      padding: 8px;
      border-radius: 6px;
    }
    
    .btn-sm {
      padding: 6px 12px;
      font-size: 0.8rem;
    }
    
    /* ===== Cards ===== */
    .card {
      background: white;
      border-radius: 12px;
      box-shadow: 0 1px 3px rgba(0,0,0,0.04);
      border: 1px solid var(--gray-100);
    }
    
    .card-header {
      padding: 16px 20px;
      border-bottom: 1px solid var(--gray-100);
      display: flex;
      justify-content: space-between;
      align-items: center;
    }
    
    .card-title {
      font-size: 1rem;
      font-weight: 600;
      color: var(--gray-900);
      margin: 0;
    }
    
    .card-body {
      padding: 20px;
    }
    
    /* ===== Strategy Type Cards ===== */
    .strategy-types-grid {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(280px, 1fr));
      gap: 16px;
      margin-bottom: 24px;
    }
    
    .strategy-type-card {
      background: white;
      border-radius: 12px;
      padding: 20px;
      border: 2px solid var(--gray-100);
      cursor: pointer;
      transition: all 0.2s;
      position: relative;
      overflow: hidden;
    }
    
    .strategy-type-card:hover {
      border-color: var(--primary);
      transform: translateY(-2px);
      box-shadow: 0 4px 12px rgba(59, 130, 246, 0.15);
    }
    
    .strategy-type-card.selected {
      border-color: var(--primary);
      background: var(--primary-light);
    }
    
    .strategy-type-icon {
      width: 48px;
      height: 48px;
      border-radius: 10px;
      display: flex;
      align-items: center;
      justify-content: center;
      font-size: 1.5rem;
      margin-bottom: 12px;
    }
    
    .strategy-type-icon.decoy { background: var(--purple-light); }
    .strategy-type-icon.anchoring { background: var(--warning-light); }
    .strategy-type-icon.time_based { background: var(--primary-light); }
    .strategy-type-icon.bundle_discount { background: var(--success-light); }
    .strategy-type-icon.margin_optimization { background: var(--danger-light); }
    
    .strategy-type-name {
      font-weight: 600;
      font-size: 1rem;
      color: var(--gray-900);
      margin-bottom: 4px;
    }
    
    .strategy-type-desc {
      font-size: 0.8rem;
      color: var(--gray-500);
      line-height: 1.4;
    }
    
    .strategy-type-badge {
      position: absolute;
      top: 12px;
      right: 12px;
      padding: 4px 8px;
      background: var(--success);
      color: white;
      font-size: 0.7rem;
      font-weight: 600;
      border-radius: 4px;
      text-transform: uppercase;
    }
    
    /* ===== Metrics Grid ===== */
    .metrics-grid {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(180px, 1fr));
      gap: 16px;
      margin-bottom: 24px;
    }
    
    .metric-card {
      background: white;
      border-radius: 12px;
      padding: 20px;
      box-shadow: 0 1px 3px rgba(0,0,0,0.04);
    }
    
    .metric-label {
      font-size: 0.75rem;
      font-weight: 600;
      color: var(--gray-500);
      text-transform: uppercase;
      letter-spacing: 0.5px;
      margin-bottom: 8px;
    }
    
    .metric-value {
      font-size: 1.75rem;
      font-weight: 700;
      color: var(--gray-900);
      line-height: 1.2;
    }
    
    .metric-sub {
      font-size: 0.8rem;
      color: var(--gray-500);
      margin-top: 4px;
    }
    
    .metric-trend {
      display: inline-flex;
      align-items: center;
      gap: 4px;
      padding: 2px 8px;
      border-radius: 4px;
      font-size: 0.75rem;
      font-weight: 600;
    }
    
    .metric-trend.up {
      background: var(--success-light);
      color: var(--success);
    }
    
    .metric-trend.down {
      background: var(--danger-light);
      color: var(--danger);
    }
    
    /* ===== Strategy List ===== */
    .strategy-list {
      display: flex;
      flex-direction: column;
      gap: 12px;
    }
    
    .strategy-item {
      display: flex;
      align-items: center;
      gap: 16px;
      padding: 16px 20px;
      background: white;
      border-radius: 10px;
      border: 1px solid var(--gray-100);
      transition: all 0.15s;
    }
    
    .strategy-item:hover {
      border-color: var(--gray-200);
      box-shadow: 0 2px 8px rgba(0,0,0,0.04);
    }
    
    .strategy-item-icon {
      width: 40px;
      height: 40px;
      border-radius: 8px;
      display: flex;
      align-items: center;
      justify-content: center;
      font-size: 1.2rem;
      flex-shrink: 0;
    }
    
    .strategy-item-info {
      flex: 1;
      min-width: 0;
    }
    
    .strategy-item-name {
      font-weight: 600;
      color: var(--gray-900);
      margin-bottom: 2px;
    }
    
    .strategy-item-meta {
      font-size: 0.8rem;
      color: var(--gray-500);
    }
    
    .strategy-item-stats {
      display: flex;
      gap: 24px;
      flex-shrink: 0;
    }
    
    .strategy-stat {
      text-align: center;
    }
    
    .strategy-stat-value {
      font-weight: 700;
      color: var(--gray-900);
      font-size: 1rem;
    }
    
    .strategy-stat-label {
      font-size: 0.7rem;
      color: var(--gray-500);
      text-transform: uppercase;
    }
    
    .strategy-item-actions {
      display: flex;
      gap: 8px;
      flex-shrink: 0;
    }
    
    /* ===== Wizard Stepper ===== */
    .wizard-stepper {
      display: flex;
      justify-content: center;
      margin-bottom: 32px;
      padding: 0 20px;
    }
    
    .wizard-step {
      display: flex;
      align-items: center;
      gap: 12px;
    }
    
    .wizard-step-circle {
      width: 36px;
      height: 36px;
      border-radius: 50%;
      display: flex;
      align-items: center;
      justify-content: center;
      font-weight: 600;
      font-size: 0.875rem;
      background: var(--gray-100);
      color: var(--gray-400);
      transition: all 0.2s;
    }
    
    .wizard-step.active .wizard-step-circle {
      background: var(--primary);
      color: white;
    }
    
    .wizard-step.completed .wizard-step-circle {
      background: var(--success);
      color: white;
    }
    
    .wizard-step-label {
      font-size: 0.875rem;
      font-weight: 500;
      color: var(--gray-400);
    }
    
    .wizard-step.active .wizard-step-label,
    .wizard-step.completed .wizard-step-label {
      color: var(--gray-700);
    }
    
    .wizard-step-connector {
      width: 60px;
      height: 2px;
      background: var(--gray-200);
      margin: 0 16px;
    }
    
    .wizard-step-connector.completed {
      background: var(--success);
    }
    
    /* ===== Wizard Content ===== */
    .wizard-content {
      min-height: 400px;
    }
    
    .wizard-step-content {
      display: none;
    }
    
    .wizard-step-content.active {
      display: block;
    }
    
    .wizard-footer {
      display: flex;
      justify-content: space-between;
      padding-top: 24px;
      margin-top: 24px;
      border-top: 1px solid var(--gray-100);
    }
    
    /* ===== Form Elements ===== */
    .form-group {
      margin-bottom: 20px;
    }
    
    .form-label {
      display: block;
      font-size: 0.875rem;
      font-weight: 600;
      color: var(--gray-700);
      margin-bottom: 6px;
    }
    
    .form-hint {
      font-size: 0.75rem;
      color: var(--gray-500);
      margin-top: 4px;
    }
    
    .form-input, .form-select, .form-textarea {
      width: 100%;
      padding: 10px 14px;
      border: 1px solid var(--gray-200);
      border-radius: 8px;
      font-size: 0.875rem;
      color: var(--gray-800);
      background: white;
      transition: all 0.15s;
    }
    
    .form-input:focus, .form-select:focus, .form-textarea:focus {
      outline: none;
      border-color: var(--primary);
      box-shadow: 0 0 0 3px rgba(59, 130, 246, 0.1);
    }
    
    .form-textarea {
      min-height: 100px;
      resize: vertical;
    }
    
    .form-row {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
      gap: 16px;
    }
    
    /* ===== Decoy Configurator ===== */
    .decoy-config {
      display: grid;
      grid-template-columns: repeat(3, 1fr);
      gap: 20px;
      margin: 24px 0;
    }
    
    .decoy-product-card {
      padding: 20px;
      border-radius: 12px;
      border: 2px dashed var(--gray-200);
      text-align: center;
      transition: all 0.2s;
    }
    
    .decoy-product-card.economy {
      background: linear-gradient(135deg, #f0fdf4 0%, #dcfce7 100%);
      border-color: var(--success);
    }
    
    .decoy-product-card.decoy {
      background: linear-gradient(135deg, #fef3c7 0%, #fde68a 100%);
      border-color: var(--warning);
    }
    
    .decoy-product-card.premium {
      background: linear-gradient(135deg, #ede9fe 0%, #ddd6fe 100%);
      border-color: var(--purple);
    }
    
    .decoy-card-title {
      font-weight: 600;
      font-size: 0.9rem;
      margin-bottom: 4px;
      text-transform: uppercase;
    }
    
    .decoy-card-subtitle {
      font-size: 0.75rem;
      color: var(--gray-600);
      margin-bottom: 16px;
    }
    
    .decoy-price-input {
      width: 100%;
      padding: 12px;
      border: 2px solid var(--gray-200);
      border-radius: 8px;
      font-size: 1.25rem;
      font-weight: 700;
      text-align: center;
      background: white;
    }
    
    .decoy-price-input:focus {
      outline: none;
      border-color: var(--primary);
    }
    
    /* ===== Anchoring Config ===== */
    .slot-grid {
      display: grid;
      grid-template-columns: repeat(6, 1fr);
      gap: 8px;
      margin: 20px 0;
      background: var(--gray-100);
      padding: 16px;
      border-radius: 12px;
    }
    
    .slot-cell {
      aspect-ratio: 1;
      background: white;
      border-radius: 8px;
      display: flex;
      flex-direction: column;
      align-items: center;
      justify-content: center;
      font-size: 0.7rem;
      font-weight: 600;
      cursor: pointer;
      border: 2px solid transparent;
      transition: all 0.15s;
    }
    
    .slot-cell:hover {
      border-color: var(--primary);
    }
    
    .slot-cell.anchor {
      background: var(--warning-light);
      border-color: var(--warning);
    }
    
    .slot-cell.anchor::after {
      content: '‚öì';
      font-size: 1rem;
      margin-top: 4px;
    }
    
    .slot-label {
      color: var(--gray-600);
    }
    
    /* ===== Time Rules ===== */
    .time-rules-list {
      display: flex;
      flex-direction: column;
      gap: 12px;
    }
    
    .time-rule-item {
      display: grid;
      grid-template-columns: 1fr 100px 100px 80px auto;
      gap: 12px;
      align-items: center;
      padding: 16px;
      background: var(--gray-50);
      border-radius: 10px;
    }
    
    .time-rule-days {
      display: flex;
      gap: 4px;
    }
    
    .day-toggle {
      width: 32px;
      height: 32px;
      border-radius: 50%;
      border: 1px solid var(--gray-200);
      background: white;
      font-size: 0.7rem;
      font-weight: 600;
      cursor: pointer;
      transition: all 0.15s;
    }
    
    .day-toggle.active {
      background: var(--primary);
      border-color: var(--primary);
      color: white;
    }
    
    .add-rule-btn {
      display: flex;
      align-items: center;
      justify-content: center;
      gap: 8px;
      width: 100%;
      padding: 14px;
      border: 2px dashed var(--gray-200);
      border-radius: 10px;
      background: transparent;
      color: var(--gray-500);
      font-weight: 500;
      cursor: pointer;
      transition: all 0.15s;
    }
    
    .add-rule-btn:hover {
      border-color: var(--primary);
      color: var(--primary);
    }
    
    /* ===== Bundle Config ===== */
    .bundle-item {
      padding: 20px;
      border: 1px solid var(--gray-200);
      border-radius: 12px;
      margin-bottom: 12px;
    }
    
    .bundle-header {
      display: flex;
      justify-content: space-between;
      align-items: center;
      margin-bottom: 16px;
    }
    
    .bundle-products {
      display: flex;
      flex-wrap: wrap;
      gap: 8px;
      margin-bottom: 16px;
    }
    
    .bundle-product-tag {
      padding: 6px 12px;
      background: var(--primary-light);
      color: var(--primary);
      border-radius: 6px;
      font-size: 0.8rem;
      font-weight: 500;
      display: flex;
      align-items: center;
      gap: 6px;
    }
    
    .bundle-product-tag .remove {
      cursor: pointer;
      opacity: 0.6;
    }
    
    .bundle-product-tag .remove:hover {
      opacity: 1;
    }
    
    .bundle-pricing {
      display: flex;
      gap: 24px;
      align-items: center;
    }
    
    .bundle-price-field {
      display: flex;
      flex-direction: column;
      gap: 4px;
    }
    
    .bundle-savings {
      padding: 6px 12px;
      background: var(--success-light);
      color: var(--success);
      border-radius: 6px;
      font-weight: 600;
      font-size: 0.875rem;
    }
    
    /* ===== Performance Chart ===== */
    .chart-container {
      position: relative;
      height: 300px;
      width: 100%;
    }
    
    .chart-legend {
      display: flex;
      justify-content: center;
      gap: 24px;
      margin-top: 16px;
    }
    
    .legend-item {
      display: flex;
      align-items: center;
      gap: 8px;
      font-size: 0.8rem;
      color: var(--gray-600);
    }
    
    .legend-dot {
      width: 12px;
      height: 12px;
      border-radius: 3px;
    }
    
    /* ===== Machine Selector ===== */
    .machine-selector {
      display: grid;
      grid-template-columns: repeat(auto-fill, minmax(250px, 1fr));
      gap: 12px;
      max-height: 400px;
      overflow-y: auto;
      padding: 4px;
    }
    
    .machine-option {
      display: flex;
      align-items: center;
      gap: 12px;
      padding: 12px 16px;
      border: 1px solid var(--gray-200);
      border-radius: 10px;
      cursor: pointer;
      transition: all 0.15s;
    }
    
    .machine-option:hover {
      border-color: var(--primary);
      background: var(--gray-50);
    }
    
    .machine-option.selected {
      border-color: var(--primary);
      background: var(--primary-light);
    }
    
    .machine-checkbox {
      width: 20px;
      height: 20px;
      border-radius: 4px;
      border: 2px solid var(--gray-300);
      display: flex;
      align-items: center;
      justify-content: center;
      flex-shrink: 0;
      transition: all 0.15s;
    }
    
    .machine-option.selected .machine-checkbox {
      background: var(--primary);
      border-color: var(--primary);
      color: white;
    }
    
    .machine-info {
      flex: 1;
      min-width: 0;
    }
    
    .machine-name {
      font-weight: 600;
      color: var(--gray-900);
      font-size: 0.875rem;
    }
    
    .machine-location {
      font-size: 0.75rem;
      color: var(--gray-500);
      white-space: nowrap;
      overflow: hidden;
      text-overflow: ellipsis;
    }
    
    /* ===== Modal ===== */
    .modal-overlay {
      position: fixed;
      top: 0;
      left: 0;
      right: 0;
      bottom: 0;
      background: rgba(0, 0, 0, 0.5);
      display: flex;
      align-items: center;
      justify-content: center;
      z-index: 10000;
      opacity: 0;
      visibility: hidden;
      transition: all 0.2s;
    }
    
    .modal-overlay.active {
      opacity: 1;
      visibility: visible;
    }
    
    .modal {
      background: white;
      border-radius: 16px;
      width: 90%;
      max-width: 800px;
      max-height: 90vh;
      overflow: hidden;
      display: flex;
      flex-direction: column;
      transform: translateY(20px);
      transition: transform 0.2s;
    }
    
    .modal-overlay.active .modal {
      transform: translateY(0);
    }
    
    .modal-header {
      padding: 20px 24px;
      border-bottom: 1px solid var(--gray-100);
      display: flex;
      justify-content: space-between;
      align-items: center;
    }
    
    .modal-title {
      font-size: 1.25rem;
      font-weight: 700;
      color: var(--gray-900);
    }
    
    .modal-close {
      width: 32px;
      height: 32px;
      border-radius: 8px;
      border: none;
      background: var(--gray-100);
      font-size: 1.25rem;
      cursor: pointer;
      display: flex;
      align-items: center;
      justify-content: center;
      transition: all 0.15s;
    }
    
    .modal-close:hover {
      background: var(--gray-200);
    }
    
    .modal-body {
      padding: 24px;
      overflow-y: auto;
      flex: 1;
    }
    
    .modal-footer {
      padding: 16px 24px;
      border-top: 1px solid var(--gray-100);
      display: flex;
      justify-content: flex-end;
      gap: 12px;
    }
    
    /* ===== Tabs ===== */
    .tabs {
      display: flex;
      gap: 4px;
      border-bottom: 1px solid var(--gray-200);
      margin-bottom: 24px;
    }
    
    .tab {
      padding: 12px 20px;
      font-size: 0.875rem;
      font-weight: 600;
      color: var(--gray-500);
      background: none;
      border: none;
      cursor: pointer;
      position: relative;
      transition: all 0.15s;
    }
    
    .tab:hover {
      color: var(--gray-700);
    }
    
    .tab.active {
      color: var(--primary);
    }
    
    .tab.active::after {
      content: '';
      position: absolute;
      bottom: -1px;
      left: 0;
      right: 0;
      height: 2px;
      background: var(--primary);
    }
    
    /* ===== Status Badge ===== */
    .status-badge {
      padding: 4px 10px;
      border-radius: 20px;
      font-size: 0.75rem;
      font-weight: 600;
    }
    
    .status-badge.active {
      background: var(--success-light);
      color: var(--success);
    }
    
    .status-badge.paused {
      background: var(--warning-light);
      color: var(--warning);
    }
    
    .status-badge.template {
      background: var(--purple-light);
      color: var(--purple);
    }
    
    /* ===== Toast ===== */
    .toast-container {
      position: fixed;
      bottom: 24px;
      right: 24px;
      z-index: 10001;
      display: flex;
      flex-direction: column;
      gap: 12px;
    }
    
    .toast {
      padding: 14px 20px;
      background: var(--gray-900);
      color: white;
      border-radius: 10px;
      font-size: 0.875rem;
      font-weight: 500;
      display: flex;
      align-items: center;
      gap: 12px;
      animation: slideIn 0.3s ease;
      box-shadow: 0 4px 12px rgba(0,0,0,0.15);
    }
    
    .toast.success {
      background: var(--success);
    }
    
    .toast.error {
      background: var(--danger);
    }
    
    @keyframes slideIn {
      from { transform: translateX(100%); opacity: 0; }
      to { transform: translateX(0); opacity: 1; }
    }
    
    /* ===== Responsive ===== */
    @media (max-width: 768px) {
      .page-header-content {
        flex-direction: column;
        align-items: flex-start;
      }
      
      .wizard-stepper {
        flex-wrap: wrap;
        gap: 12px;
      }
      
      .wizard-step-connector {
        display: none;
      }
      
      .decoy-config {
        grid-template-columns: 1fr;
      }
      
      .slot-grid {
        grid-template-columns: repeat(4, 1fr);
      }
      
      .time-rule-item {
        grid-template-columns: 1fr;
      }
      
      .strategy-item {
        flex-direction: column;
        align-items: flex-start;
      }
      
      .strategy-item-stats {
        width: 100%;
        justify-content: space-between;
        margin-top: 12px;
      }
    }
    
    /* ===== Loading Spinner ===== */
    .spinner {
      width: 20px;
      height: 20px;
      border: 2px solid var(--gray-200);
      border-top-color: var(--primary);
      border-radius: 50%;
      animation: spin 0.8s linear infinite;
    }
    
    @keyframes spin {
      to { transform: rotate(360deg); }
    }
    
    /* ===== Empty State ===== */
    .empty-state {
      text-align: center;
      padding: 48px 24px;
    }
    
    .empty-state-icon {
      font-size: 3rem;
      margin-bottom: 16px;
    }
    
    .empty-state-title {
      font-size: 1.125rem;
      font-weight: 600;
      color: var(--gray-900);
      margin-bottom: 8px;
    }
    
    .empty-state-desc {
      color: var(--gray-500);
      margin-bottom: 24px;
    }
  </style>
</head>
<body>
  <!-- Header -->
  <header class="page-header">
    <div class="page-header-content">
      <div>
        <h1 class="page-title">üí∞ Pricing Strategies</h1>
        <p class="page-subtitle">Optimize margins with psychological pricing tactics ‚Äî decoy effect, anchoring, and more</p>
      </div>
      <div class="header-actions">
        <button class="btn btn-secondary" onclick="showTemplates()">
          üìã Templates
        </button>
        <button class="btn btn-primary" onclick="openCreateWizard()">
          <span>+ Create Strategy</span>
        </button>
      </div>
    </div>
  </header>

  <div class="container-fluid">
    <!-- KPI Metrics -->
    <div class="metrics-grid" id="metricsGrid">
      <div class="metric-card">
        <div class="metric-label">Active Strategies</div>
        <div class="metric-value" id="metricActiveCount">0</div>
        <div class="metric-sub">across all machines</div>
      </div>
      <div class="metric-card">
        <div class="metric-label">Avg Margin</div>
        <div class="metric-value" id="metricAvgMargin">67%</div>
        <div class="metric-sub">
          <span class="metric-trend up">‚Üë 3%</span>
          target: 67%
        </div>
      </div>
      <div class="metric-card">
        <div class="metric-label">Avg Item Price</div>
        <div class="metric-value" id="metricAvgPrice">$2.87</div>
        <div class="metric-sub">
          target: $3.00
        </div>
      </div>
      <div class="metric-card">
        <div class="metric-label">Revenue Lift</div>
        <div class="metric-value" id="metricRevLift">+12%</div>
        <div class="metric-sub">from pricing strategies</div>
      </div>
      <div class="metric-card">
        <div class="metric-label">Premium Conversions</div>
        <div class="metric-value" id="metricPremiumConv">34%</div>
        <div class="metric-sub">decoy effect working</div>
      </div>
    </div>

    <!-- Main Tabs -->
    <div class="tabs">
      <button class="tab active" data-tab="strategies" onclick="switchTab('strategies')">My Strategies</button>
      <button class="tab" data-tab="performance" onclick="switchTab('performance')">Performance</button>
      <button class="tab" data-tab="ab-tests" onclick="switchTab('ab-tests')">A/B Tests</button>
      <button class="tab" data-tab="price-overrides" onclick="switchTab('price-overrides')">Slot Overrides</button>
    </div>

    <!-- Tab: Strategies -->
    <div id="tab-strategies" class="tab-content active">
      <div class="card">
        <div class="card-header">
          <h3 class="card-title">Active & Draft Strategies</h3>
          <div style="display: flex; gap: 8px;">
            <select class="form-select" style="width: auto; padding: 6px 12px; font-size: 0.8rem;" id="filterType">
              <option value="">All Types</option>
              <option value="decoy">Decoy Effect</option>
              <option value="anchoring">Anchoring</option>
              <option value="time_based">Time-Based</option>
              <option value="bundle_discount">Bundle Discount</option>
            </select>
          </div>
        </div>
        <div class="card-body" id="strategiesContainer">
          <div class="strategy-list" id="strategyList">
            <!-- Populated by JS -->
          </div>
        </div>
      </div>
    </div>

    <!-- Tab: Performance -->
    <div id="tab-performance" class="tab-content" style="display:none;">
      <div class="card">
        <div class="card-header">
          <h3 class="card-title">Strategy Performance Comparison</h3>
          <select class="form-select" style="width: auto; padding: 6px 12px; font-size: 0.8rem;" id="performancePeriod">
            <option value="7d">Last 7 Days</option>
            <option value="30d" selected>Last 30 Days</option>
            <option value="90d">Last 90 Days</option>
          </select>
        </div>
        <div class="card-body">
          <div class="chart-container">
            <canvas id="performanceChart"></canvas>
          </div>
          <div class="chart-legend">
            <div class="legend-item"><span class="legend-dot" style="background: var(--primary);"></span> Revenue</div>
            <div class="legend-item"><span class="legend-dot" style="background: var(--success);"></span> Margin %</div>
            <div class="legend-item"><span class="legend-dot" style="background: var(--purple);"></span> Premium Conv.</div>
          </div>
        </div>
      </div>
      
      <div class="strategy-types-grid" style="margin-top: 24px;">
        <div class="card">
          <div class="card-header">
            <h3 class="card-title">Top Performing Strategy</h3>
          </div>
          <div class="card-body" id="topPerformer">
            <div style="text-align: center; padding: 20px;">
              <div style="font-size: 2rem; margin-bottom: 8px;">üèÜ</div>
              <div style="font-weight: 600; font-size: 1.1rem;" id="topStrategyName">Classic Decoy Effect</div>
              <div style="color: var(--gray-500); font-size: 0.875rem; margin-top: 4px;">+18% revenue lift</div>
            </div>
          </div>
        </div>
        <div class="card">
          <div class="card-header">
            <h3 class="card-title">Strategy Insights</h3>
          </div>
          <div class="card-body">
            <ul style="list-style: none; padding: 0; font-size: 0.875rem;">
              <li style="padding: 8px 0; border-bottom: 1px solid var(--gray-100);">
                üí° Decoy products are converting <strong>34%</strong> more customers to premium
              </li>
              <li style="padding: 8px 0; border-bottom: 1px solid var(--gray-100);">
                ‚è∞ Happy Hour discounts driving <strong>22%</strong> more sales 6-8am
              </li>
              <li style="padding: 8px 0;">
                üì¶ Bundle deals increasing avg transaction by <strong>$1.20</strong>
              </li>
            </ul>
          </div>
        </div>
      </div>
    </div>

    <!-- Tab: A/B Tests -->
    <div id="tab-ab-tests" class="tab-content" style="display:none;">
      <div class="card">
        <div class="card-header">
          <h3 class="card-title">A/B Tests</h3>
          <button class="btn btn-primary btn-sm" onclick="createABTest()">+ New Test</button>
        </div>
        <div class="card-body">
          <div class="empty-state">
            <div class="empty-state-icon">üß™</div>
            <div class="empty-state-title">No A/B Tests Yet</div>
            <div class="empty-state-desc">Compare strategy variations to find what works best for your machines.</div>
            <button class="btn btn-primary" onclick="createABTest()">Create First Test</button>
          </div>
        </div>
      </div>
    </div>

    <!-- Tab: Slot Overrides -->
    <div id="tab-price-overrides" class="tab-content" style="display:none;">
      <div class="card">
        <div class="card-header">
          <h3 class="card-title">Per-Slot Price Overrides</h3>
          <button class="btn btn-primary btn-sm" onclick="openOverrideModal()">+ Add Override</button>
        </div>
        <div class="card-body">
          <p style="color: var(--gray-500); font-size: 0.875rem; margin-bottom: 20px;">
            Manual price overrides take priority over any strategy. Use sparingly for specific situations.
          </p>
          <div id="overridesList">
            <table style="width: 100%; border-collapse: collapse;">
              <thead>
                <tr style="background: var(--gray-50);">
                  <th style="padding: 12px; text-align: left; font-size: 0.8rem; font-weight: 600; color: var(--gray-600);">Machine</th>
                  <th style="padding: 12px; text-align: left; font-size: 0.8rem; font-weight: 600; color: var(--gray-600);">Slot</th>
                  <th style="padding: 12px; text-align: left; font-size: 0.8rem; font-weight: 600; color: var(--gray-600);">Product</th>
                  <th style="padding: 12px; text-align: right; font-size: 0.8rem; font-weight: 600; color: var(--gray-600);">Original</th>
                  <th style="padding: 12px; text-align: right; font-size: 0.8rem; font-weight: 600; color: var(--gray-600);">Override</th>
                  <th style="padding: 12px; text-align: left; font-size: 0.8rem; font-weight: 600; color: var(--gray-600);">Reason</th>
                  <th style="padding: 12px; text-align: center; font-size: 0.8rem; font-weight: 600; color: var(--gray-600);">Actions</th>
                </tr>
              </thead>
              <tbody id="overridesTableBody">
                <!-- Populated by JS -->
              </tbody>
            </table>
          </div>
        </div>
      </div>
    </div>
  </div>

  <!-- Create Strategy Modal -->
  <div class="modal-overlay" id="createModal">
    <div class="modal" style="max-width: 900px;">
      <div class="modal-header">
        <h2 class="modal-title">Create Pricing Strategy</h2>
        <button class="modal-close" onclick="closeCreateWizard()">&times;</button>
      </div>
      <div class="modal-body">
        <!-- Wizard Stepper -->
        <div class="wizard-stepper">
          <div class="wizard-step active" data-step="1">
            <div class="wizard-step-circle">1</div>
            <span class="wizard-step-label">Type</span>
          </div>
          <div class="wizard-step-connector"></div>
          <div class="wizard-step" data-step="2">
            <div class="wizard-step-circle">2</div>
            <span class="wizard-step-label">Configure</span>
          </div>
          <div class="wizard-step-connector"></div>
          <div class="wizard-step" data-step="3">
            <div class="wizard-step-circle">3</div>
            <span class="wizard-step-label">Apply</span>
          </div>
        </div>

        <div class="wizard-content">
          <!-- Step 1: Choose Type -->
          <div class="wizard-step-content active" data-step="1">
            <h3 style="margin-bottom: 16px; font-size: 1.1rem; color: var(--gray-700);">Choose Strategy Type</h3>
            <div class="strategy-types-grid">
              <div class="strategy-type-card" data-type="decoy" onclick="selectStrategyType('decoy')">
                <div class="strategy-type-badge">Popular</div>
                <div class="strategy-type-icon decoy">üéØ</div>
                <div class="strategy-type-name">Decoy Effect</div>
                <div class="strategy-type-desc">Add a strategic "decoy" product to make your target item more attractive. Typically increases premium sales by 30%.</div>
              </div>
              <div class="strategy-type-card" data-type="anchoring" onclick="selectStrategyType('anchoring')">
                <div class="strategy-type-icon anchoring">‚öì</div>
                <div class="strategy-type-name">Price Anchoring</div>
                <div class="strategy-type-desc">Place high-priced items at eye level to set price expectations. Makes other items feel like great value.</div>
              </div>
              <div class="strategy-type-card" data-type="time_based" onclick="selectStrategyType('time_based')">
                <div class="strategy-type-icon time_based">‚è∞</div>
                <div class="strategy-type-name">Time-Based Pricing</div>
                <div class="strategy-type-desc">Offer discounts during slow periods to boost volume without sacrificing peak margins.</div>
              </div>
              <div class="strategy-type-card" data-type="bundle_discount" onclick="selectStrategyType('bundle_discount')">
                <div class="strategy-type-icon bundle_discount">üì¶</div>
                <div class="strategy-type-name">Bundle Discount</div>
                <div class="strategy-type-desc">Create combo deals for complementary products. Increases average transaction value.</div>
              </div>
            </div>
          </div>

          <!-- Step 2: Configure -->
          <div class="wizard-step-content" data-step="2">
            <div class="form-group">
              <label class="form-label">Strategy Name</label>
              <input type="text" class="form-input" id="strategyName" placeholder="e.g., Premium Snack Decoy">
            </div>
            <div class="form-group">
              <label class="form-label">Description (optional)</label>
              <textarea class="form-textarea" id="strategyDesc" placeholder="Describe the goal of this strategy..."></textarea>
            </div>
            
            <!-- Decoy Configuration -->
            <div id="configDecoy" class="config-panel" style="display: none;">
              <h4 style="margin: 24px 0 16px; font-size: 1rem; color: var(--gray-700);">Decoy Product Setup</h4>
              <p style="color: var(--gray-500); font-size: 0.875rem; margin-bottom: 20px;">
                The decoy should be slightly inferior to your premium product but priced close to it, making premium the obvious choice.
              </p>
              <div class="decoy-config">
                <div class="decoy-product-card economy">
                  <div class="decoy-card-title" style="color: var(--success);">Economy Option</div>
                  <div class="decoy-card-subtitle">Low price, basic value</div>
                  <select class="form-select" id="decoyEconomyProduct" style="margin-bottom: 12px;">
                    <option value="">Select product...</option>
                  </select>
                  <input type="number" class="decoy-price-input" id="decoyEconomyPrice" placeholder="$1.75" step="0.25" min="0.50">
                </div>
                <div class="decoy-product-card decoy">
                  <div class="decoy-card-title" style="color: var(--warning);">üéØ Decoy</div>
                  <div class="decoy-card-subtitle">Strategic middle option</div>
                  <select class="form-select" id="decoyDecoyProduct" style="margin-bottom: 12px;">
                    <option value="">Select product...</option>
                  </select>
                  <input type="number" class="decoy-price-input" id="decoyDecoyPrice" placeholder="$2.75" step="0.25" min="0.50">
                </div>
                <div class="decoy-product-card premium">
                  <div class="decoy-card-title" style="color: var(--purple);">Premium Target</div>
                  <div class="decoy-card-subtitle">What you want them to buy</div>
                  <select class="form-select" id="decoyPremiumProduct" style="margin-bottom: 12px;">
                    <option value="">Select product...</option>
                  </select>
                  <input type="number" class="decoy-price-input" id="decoyPremiumPrice" placeholder="$2.99" step="0.25" min="0.50">
                </div>
              </div>
              <div style="background: var(--primary-light); padding: 16px; border-radius: 10px; margin-top: 16px;">
                <strong style="color: var(--primary);">üí° Pro Tip:</strong>
                <span style="color: var(--gray-600); font-size: 0.875rem;">
                  The decoy should be obviously worse than premium (smaller size, less popular flavor) at nearly the same price.
                </span>
              </div>
            </div>
            
            <!-- Anchoring Configuration -->
            <div id="configAnchoring" class="config-panel" style="display: none;">
              <h4 style="margin: 24px 0 16px; font-size: 1rem; color: var(--gray-700);">Anchor Placement</h4>
              <p style="color: var(--gray-500); font-size: 0.875rem; margin-bottom: 20px;">
                Click slots to mark as anchor positions (typically top row, eye level). Place your highest-priced items here.
              </p>
              <div class="slot-grid" id="anchorSlotGrid">
                <!-- Generated by JS -->
              </div>
              <div class="form-row" style="margin-top: 20px;">
                <div class="form-group">
                  <label class="form-label">Minimum Anchor Price</label>
                  <input type="number" class="form-input" id="anchorMinPrice" value="3.50" step="0.25" min="1.00">
                  <div class="form-hint">Products below this price won't be placed in anchor slots</div>
                </div>
                <div class="form-group">
                  <label class="form-label">Anchor Categories</label>
                  <select class="form-select" id="anchorCategories" multiple style="height: 100px;">
                    <option value="energy_drink" selected>Energy Drinks</option>
                    <option value="premium_snack" selected>Premium Snacks</option>
                    <option value="protein">Protein Items</option>
                    <option value="candy">Candy</option>
                  </select>
                </div>
              </div>
            </div>
            
            <!-- Time-Based Configuration -->
            <div id="configTimeBased" class="config-panel" style="display: none;">
              <h4 style="margin: 24px 0 16px; font-size: 1rem; color: var(--gray-700);">Time-Based Rules</h4>
              <p style="color: var(--gray-500); font-size: 0.875rem; margin-bottom: 20px;">
                Set discounts for specific time windows. Great for boosting slow periods without hurting peak margins.
              </p>
              <div class="time-rules-list" id="timeRulesList">
                <div class="time-rule-item">
                  <div>
                    <div style="font-weight: 600; margin-bottom: 8px; font-size: 0.875rem;">Days Active</div>
                    <div class="time-rule-days">
                      <button class="day-toggle" data-day="0">S</button>
                      <button class="day-toggle active" data-day="1">M</button>
                      <button class="day-toggle active" data-day="2">T</button>
                      <button class="day-toggle active" data-day="3">W</button>
                      <button class="day-toggle active" data-day="4">T</button>
                      <button class="day-toggle active" data-day="5">F</button>
                      <button class="day-toggle" data-day="6">S</button>
                    </div>
                  </div>
                  <div>
                    <div style="font-size: 0.75rem; color: var(--gray-500); margin-bottom: 4px;">Start</div>
                    <input type="time" class="form-input" value="06:00" style="padding: 6px 10px;">
                  </div>
                  <div>
                    <div style="font-size: 0.75rem; color: var(--gray-500); margin-bottom: 4px;">End</div>
                    <input type="time" class="form-input" value="08:00" style="padding: 6px 10px;">
                  </div>
                  <div>
                    <div style="font-size: 0.75rem; color: var(--gray-500); margin-bottom: 4px;">Discount</div>
                    <input type="number" class="form-input" value="10" min="1" max="50" style="padding: 6px 10px; width: 70px;">
                    <span style="font-size: 0.8rem; color: var(--gray-500);">%</span>
                  </div>
                  <button class="btn btn-icon btn-secondary" style="color: var(--danger);" onclick="this.closest('.time-rule-item').remove()">üóëÔ∏è</button>
                </div>
              </div>
              <button class="add-rule-btn" onclick="addTimeRule()">+ Add Time Rule</button>
              <div class="form-group" style="margin-top: 20px;">
                <label class="form-label">Minimum Margin Protection</label>
                <input type="number" class="form-input" id="timeMinMargin" value="40" min="20" max="80" style="width: 100px;">
                <span style="margin-left: 8px; color: var(--gray-500);">%</span>
                <div class="form-hint">Discounts won't apply if margin would drop below this</div>
              </div>
            </div>
            
            <!-- Bundle Configuration -->
            <div id="configBundle" class="config-panel" style="display: none;">
              <h4 style="margin: 24px 0 16px; font-size: 1rem; color: var(--gray-700);">Bundle Deals</h4>
              <p style="color: var(--gray-500); font-size: 0.875rem; margin-bottom: 20px;">
                Create combo deals to increase average transaction value. Bundle complementary items.
              </p>
              <div id="bundlesList">
                <div class="bundle-item">
                  <div class="bundle-header">
                    <input type="text" class="form-input" placeholder="Bundle name (e.g., Energy Combo)" style="max-width: 300px;">
                    <button class="btn btn-icon btn-secondary" style="color: var(--danger);" onclick="this.closest('.bundle-item').remove()">üóëÔ∏è</button>
                  </div>
                  <div class="bundle-products">
                    <div class="bundle-product-tag">
                      Energy Drink <span class="remove" onclick="this.closest('.bundle-product-tag').remove()">&times;</span>
                    </div>
                    <div class="bundle-product-tag">
                      Protein Bar <span class="remove" onclick="this.closest('.bundle-product-tag').remove()">&times;</span>
                    </div>
                    <button class="btn btn-sm btn-secondary" onclick="addProductToBundle(this)">+ Add Product</button>
                  </div>
                  <div class="bundle-pricing">
                    <div class="bundle-price-field">
                      <span style="font-size: 0.75rem; color: var(--gray-500);">Original Total</span>
                      <input type="number" class="form-input" value="5.50" step="0.25" style="width: 100px;">
                    </div>
                    <span style="font-size: 1.5rem; color: var(--gray-400);">‚Üí</span>
                    <div class="bundle-price-field">
                      <span style="font-size: 0.75rem; color: var(--gray-500);">Bundle Price</span>
                      <input type="number" class="form-input" value="4.99" step="0.25" style="width: 100px;">
                    </div>
                    <div class="bundle-savings">Save 9%</div>
                  </div>
                </div>
              </div>
              <button class="add-rule-btn" onclick="addBundle()">+ Add Bundle</button>
            </div>
          </div>

          <!-- Step 3: Apply to Machines -->
          <div class="wizard-step-content" data-step="3">
            <h3 style="margin-bottom: 8px; font-size: 1.1rem; color: var(--gray-700);">Apply to Machines</h3>
            <p style="color: var(--gray-500); font-size: 0.875rem; margin-bottom: 20px;">
              Select which machines should use this strategy. You can also save as a template to apply later.
            </p>
            <div style="display: flex; gap: 12px; margin-bottom: 20px;">
              <button class="btn btn-secondary btn-sm" onclick="selectAllMachines()">Select All</button>
              <button class="btn btn-secondary btn-sm" onclick="deselectAllMachines()">Deselect All</button>
              <label style="display: flex; align-items: center; gap: 8px; margin-left: auto; font-size: 0.875rem; color: var(--gray-600);">
                <input type="checkbox" id="saveAsTemplate">
                Save as template (don't apply yet)
              </label>
            </div>
            <div class="machine-selector" id="machineSelector">
              <!-- Populated by JS -->
            </div>
          </div>
        </div>
      </div>
      <div class="modal-footer wizard-footer">
        <button class="btn btn-secondary" id="wizardBackBtn" onclick="wizardBack()" style="display: none;">‚Üê Back</button>
        <div style="flex: 1;"></div>
        <button class="btn btn-secondary" onclick="closeCreateWizard()">Cancel</button>
        <button class="btn btn-primary" id="wizardNextBtn" onclick="wizardNext()">Next ‚Üí</button>
      </div>
    </div>
  </div>

  <!-- Apply Strategy Modal -->
  <div class="modal-overlay" id="applyModal">
    <div class="modal" style="max-width: 600px;">
      <div class="modal-header">
        <h2 class="modal-title">Apply Strategy</h2>
        <button class="modal-close" onclick="closeApplyModal()">&times;</button>
      </div>
      <div class="modal-body">
        <p style="margin-bottom: 16px; color: var(--gray-600);">
          Select machines to apply <strong id="applyStrategyName">Strategy Name</strong>:
        </p>
        <div class="machine-selector" id="applyMachineSelector">
          <!-- Populated by JS -->
        </div>
      </div>
      <div class="modal-footer">
        <button class="btn btn-secondary" onclick="closeApplyModal()">Cancel</button>
        <button class="btn btn-success" onclick="confirmApplyStrategy()">Apply to Selected</button>
      </div>
    </div>
  </div>

  <!-- Toast Container -->
  <div class="toast-container" id="toastContainer"></div>

  <script src="/nav.js"></script>
  <script>
    // ===== State =====
    let strategies = [];
    let machines = [];
    let currentWizardStep = 1;
    let selectedStrategyType = null;
    let selectedMachines = new Set();
    let applyingStrategyId = null;
    let performanceChart = null;

    // ===== Initialization =====
    document.addEventListener('DOMContentLoaded', () => {
      loadStrategies();
      loadMachines();
      initAnchorGrid();
      initPerformanceChart();
    });

    // ===== API Functions =====
    async function loadStrategies() {
      try {
        const res = await fetch('/api/pricing-strategies');
        if (res.ok) {
          strategies = await res.json();
          renderStrategies();
          updateMetrics();
        }
      } catch (err) {
        console.error('Failed to load strategies:', err);
        // Show sample data for demo
        strategies = getSampleStrategies();
        renderStrategies();
      }
    }

    async function loadMachines() {
      try {
        const res = await fetch('/api/machines');
        if (res.ok) {
          machines = await res.json();
          renderMachineSelector();
        }
      } catch (err) {
        console.error('Failed to load machines:', err);
        machines = getSampleMachines();
        renderMachineSelector();
      }
    }

    async function createStrategy(data) {
      try {
        const res = await fetch('/api/pricing-strategies', {
          method: 'POST',
          headers: { 'Content-Type': 'application/json' },
          body: JSON.stringify(data)
        });
        if (res.ok) {
          const strategy = await res.json();
          strategies.push(strategy);
          renderStrategies();
          showToast('Strategy created successfully!', 'success');
          return strategy;
        }
      } catch (err) {
        console.error('Failed to create strategy:', err);
        showToast('Failed to create strategy', 'error');
      }
      return null;
    }

    async function applyStrategy(strategyId, machineIds) {
      try {
        for (const machineId of machineIds) {
          await fetch(`/api/machines/${machineId}/apply-strategy`, {
            method: 'POST',
            headers: { 'Content-Type': 'application/json' },
            body: JSON.stringify({ strategy_id: strategyId })
          });
        }
        showToast(`Strategy applied to ${machineIds.length} machine(s)!`, 'success');
        loadStrategies();
      } catch (err) {
        console.error('Failed to apply strategy:', err);
        showToast('Failed to apply strategy', 'error');
      }
    }

    async function deleteStrategy(id) {
      if (!confirm('Are you sure you want to delete this strategy?')) return;
      try {
        const res = await fetch(`/api/pricing-strategies/${id}`, { method: 'DELETE' });
        if (res.ok) {
          strategies = strategies.filter(s => s.id !== id);
          renderStrategies();
          showToast('Strategy deleted', 'success');
        }
      } catch (err) {
        console.error('Failed to delete strategy:', err);
        showToast('Failed to delete strategy', 'error');
      }
    }

    // ===== Render Functions =====
    function renderStrategies() {
      const container = document.getElementById('strategyList');
      const filterType = document.getElementById('filterType').value;
      
      const filtered = filterType 
        ? strategies.filter(s => s.type === filterType)
        : strategies;
      
      if (filtered.length === 0) {
        container.innerHTML = `
          <div class="empty-state">
            <div class="empty-state-icon">üí∞</div>
            <div class="empty-state-title">No Strategies Yet</div>
            <div class="empty-state-desc">Create your first pricing strategy to optimize your margins.</div>
            <button class="btn btn-primary" onclick="openCreateWizard()">Create Strategy</button>
          </div>
        `;
        return;
      }
      
      container.innerHTML = filtered.map(s => `
        <div class="strategy-item">
          <div class="strategy-item-icon" style="background: ${getTypeColor(s.type, true)};">
            ${getTypeIcon(s.type)}
          </div>
          <div class="strategy-item-info">
            <div class="strategy-item-name">
              ${s.name}
              ${s.is_template ? '<span class="status-badge template" style="margin-left: 8px;">Template</span>' : ''}
              ${s.is_active && !s.is_template ? '<span class="status-badge active" style="margin-left: 8px;">Active</span>' : ''}
            </div>
            <div class="strategy-item-meta">
              ${getTypeName(s.type)} ‚Ä¢ Created ${formatDate(s.created_at)}
              ${s.machines_applied ? ` ‚Ä¢ Applied to ${s.machines_applied} machine(s)` : ''}
            </div>
          </div>
          <div class="strategy-item-stats">
            <div class="strategy-stat">
              <div class="strategy-stat-value">${s.revenue_lift || '+0%'}</div>
              <div class="strategy-stat-label">Rev Lift</div>
            </div>
            <div class="strategy-stat">
              <div class="strategy-stat-value">${s.margin || '67%'}</div>
              <div class="strategy-stat-label">Margin</div>
            </div>
          </div>
          <div class="strategy-item-actions">
            <button class="btn btn-sm btn-success" onclick="openApplyModal(${s.id})" title="Apply to machines">
              Apply
            </button>
            <button class="btn btn-sm btn-secondary" onclick="editStrategy(${s.id})" title="Edit">
              ‚úèÔ∏è
            </button>
            <button class="btn btn-sm btn-secondary" onclick="deleteStrategy(${s.id})" title="Delete" style="color: var(--danger);">
              üóëÔ∏è
            </button>
          </div>
        </div>
      `).join('');
    }

    function renderMachineSelector() {
      const containers = ['machineSelector', 'applyMachineSelector'];
      
      containers.forEach(containerId => {
        const container = document.getElementById(containerId);
        if (!container) return;
        
        container.innerHTML = machines.map(m => `
          <div class="machine-option ${selectedMachines.has(m.id) ? 'selected' : ''}" 
               data-id="${m.id}" 
               onclick="toggleMachine(${m.id})">
            <div class="machine-checkbox">${selectedMachines.has(m.id) ? '‚úì' : ''}</div>
            <div class="machine-info">
              <div class="machine-name">${m.name || 'Machine ' + m.id}</div>
              <div class="machine-location">${m.location_name || m.location || 'No location'}</div>
            </div>
          </div>
        `).join('');
      });
    }

    function updateMetrics() {
      const activeCount = strategies.filter(s => s.is_active && !s.is_template).length;
      document.getElementById('metricActiveCount').textContent = activeCount;
      
      // Other metrics would be calculated from real data
    }

    // ===== Wizard Functions =====
    function openCreateWizard() {
      document.getElementById('createModal').classList.add('active');
      resetWizard();
    }

    function closeCreateWizard() {
      document.getElementById('createModal').classList.remove('active');
      resetWizard();
    }

    function resetWizard() {
      currentWizardStep = 1;
      selectedStrategyType = null;
      selectedMachines.clear();
      updateWizardUI();
      
      // Reset form fields
      document.getElementById('strategyName').value = '';
      document.getElementById('strategyDesc').value = '';
      document.querySelectorAll('.strategy-type-card').forEach(c => c.classList.remove('selected'));
      document.querySelectorAll('.config-panel').forEach(p => p.style.display = 'none');
    }

    function updateWizardUI() {
      // Update stepper
      document.querySelectorAll('.wizard-step').forEach((step, i) => {
        const stepNum = i + 1;
        step.classList.remove('active', 'completed');
        if (stepNum === currentWizardStep) step.classList.add('active');
        if (stepNum < currentWizardStep) step.classList.add('completed');
      });
      
      document.querySelectorAll('.wizard-step-connector').forEach((conn, i) => {
        conn.classList.toggle('completed', i + 1 < currentWizardStep);
      });
      
      // Update content
      document.querySelectorAll('.wizard-step-content').forEach((content, i) => {
        content.classList.toggle('active', i + 1 === currentWizardStep);
      });
      
      // Update buttons
      document.getElementById('wizardBackBtn').style.display = currentWizardStep > 1 ? 'block' : 'none';
      document.getElementById('wizardNextBtn').textContent = currentWizardStep === 3 ? 'Create Strategy' : 'Next ‚Üí';
    }

    function wizardNext() {
      if (currentWizardStep === 1) {
        if (!selectedStrategyType) {
          showToast('Please select a strategy type', 'error');
          return;
        }
        currentWizardStep = 2;
      } else if (currentWizardStep === 2) {
        const name = document.getElementById('strategyName').value.trim();
        if (!name) {
          showToast('Please enter a strategy name', 'error');
          return;
        }
        currentWizardStep = 3;
        renderMachineSelector();
      } else if (currentWizardStep === 3) {
        saveStrategy();
        return;
      }
      updateWizardUI();
    }

    function wizardBack() {
      if (currentWizardStep > 1) {
        currentWizardStep--;
        updateWizardUI();
      }
    }

    function selectStrategyType(type) {
      selectedStrategyType = type;
      document.querySelectorAll('.strategy-type-card').forEach(c => {
        c.classList.toggle('selected', c.dataset.type === type);
      });
      
      // Show appropriate config panel
      document.querySelectorAll('.config-panel').forEach(p => p.style.display = 'none');
      const configPanel = document.getElementById('config' + capitalize(type.replace('_', '')));
      if (configPanel) {
        configPanel.style.display = 'block';
      } else {
        // Handle time_based -> TimeBased, bundle_discount -> Bundle
        const mappings = {
          'time_based': 'configTimeBased',
          'bundle_discount': 'configBundle',
          'decoy': 'configDecoy',
          'anchoring': 'configAnchoring'
        };
        const panelId = mappings[type];
        if (panelId) document.getElementById(panelId).style.display = 'block';
      }
    }

    async function saveStrategy() {
      const name = document.getElementById('strategyName').value.trim();
      const desc = document.getElementById('strategyDesc').value.trim();
      const isTemplate = document.getElementById('saveAsTemplate').checked;
      
      const config = buildConfigFromUI();
      
      const data = {
        name,
        description: desc,
        type: selectedStrategyType,
        config,
        is_template: isTemplate,
        is_active: !isTemplate
      };
      
      const strategy = await createStrategy(data);
      
      if (strategy && !isTemplate && selectedMachines.size > 0) {
        await applyStrategy(strategy.id, Array.from(selectedMachines));
      }
      
      closeCreateWizard();
    }

    function buildConfigFromUI() {
      const config = {};
      
      switch (selectedStrategyType) {
        case 'decoy':
          config.economy = {
            product_id: document.getElementById('decoyEconomyProduct')?.value,
            price: parseFloat(document.getElementById('decoyEconomyPrice')?.value) || 1.75
          };
          config.decoy = {
            product_id: document.getElementById('decoyDecoyProduct')?.value,
            price: parseFloat(document.getElementById('decoyDecoyPrice')?.value) || 2.75
          };
          config.premium = {
            product_id: document.getElementById('decoyPremiumProduct')?.value,
            price: parseFloat(document.getElementById('decoyPremiumPrice')?.value) || 2.99
          };
          break;
          
        case 'anchoring':
          config.anchor_positions = Array.from(document.querySelectorAll('.slot-cell.anchor')).map(s => s.dataset.slot);
          config.min_price = parseFloat(document.getElementById('anchorMinPrice')?.value) || 3.50;
          config.categories = Array.from(document.getElementById('anchorCategories')?.selectedOptions || []).map(o => o.value);
          break;
          
        case 'time_based':
          config.rules = [];
          document.querySelectorAll('.time-rule-item').forEach(rule => {
            const days = Array.from(rule.querySelectorAll('.day-toggle.active')).map(b => parseInt(b.dataset.day));
            const inputs = rule.querySelectorAll('input');
            config.rules.push({
              days,
              start_hour: inputs[0]?.value || '06:00',
              end_hour: inputs[1]?.value || '08:00',
              discount_percent: parseInt(inputs[2]?.value) || 10
            });
          });
          config.min_margin = parseInt(document.getElementById('timeMinMargin')?.value) || 40;
          break;
          
        case 'bundle_discount':
          config.bundles = [];
          document.querySelectorAll('.bundle-item').forEach(bundle => {
            const nameInput = bundle.querySelector('input[type="text"]');
            const priceInputs = bundle.querySelectorAll('input[type="number"]');
            config.bundles.push({
              name: nameInput?.value || 'Bundle',
              products: Array.from(bundle.querySelectorAll('.bundle-product-tag')).map(t => t.textContent.trim().replace(' √ó', '')),
              original_total: parseFloat(priceInputs[0]?.value) || 5.50,
              bundle_price: parseFloat(priceInputs[1]?.value) || 4.99
            });
          });
          break;
      }
      
      return config;
    }

    // ===== Apply Modal =====
    function openApplyModal(strategyId) {
      applyingStrategyId = strategyId;
      const strategy = strategies.find(s => s.id === strategyId);
      document.getElementById('applyStrategyName').textContent = strategy?.name || 'Strategy';
      selectedMachines.clear();
      renderMachineSelector();
      document.getElementById('applyModal').classList.add('active');
    }

    function closeApplyModal() {
      document.getElementById('applyModal').classList.remove('active');
      applyingStrategyId = null;
    }

    function confirmApplyStrategy() {
      if (selectedMachines.size === 0) {
        showToast('Please select at least one machine', 'error');
        return;
      }
      applyStrategy(applyingStrategyId, Array.from(selectedMachines));
      closeApplyModal();
    }

    // ===== Machine Selection =====
    function toggleMachine(id) {
      if (selectedMachines.has(id)) {
        selectedMachines.delete(id);
      } else {
        selectedMachines.add(id);
      }
      renderMachineSelector();
    }

    function selectAllMachines() {
      machines.forEach(m => selectedMachines.add(m.id));
      renderMachineSelector();
    }

    function deselectAllMachines() {
      selectedMachines.clear();
      renderMachineSelector();
    }

    // ===== Tab Switching =====
    function switchTab(tabId) {
      document.querySelectorAll('.tab').forEach(t => t.classList.remove('active'));
      document.querySelector(`.tab[data-tab="${tabId}"]`).classList.add('active');
      
      document.querySelectorAll('.tab-content').forEach(c => c.style.display = 'none');
      document.getElementById(`tab-${tabId}`).style.display = 'block';
      
      if (tabId === 'performance') {
        updatePerformanceChart();
      }
    }

    // ===== Anchor Grid =====
    function initAnchorGrid() {
      const grid = document.getElementById('anchorSlotGrid');
      if (!grid) return;
      
      const rows = 5;
      const cols = 6;
      let html = '';
      
      for (let r = 0; r < rows; r++) {
        for (let c = 0; c < cols; c++) {
          const slot = String.fromCharCode(65 + r) + (c + 1);
          const isTopRow = r < 2;
          html += `
            <div class="slot-cell ${isTopRow ? 'anchor' : ''}" 
                 data-slot="${slot}" 
                 onclick="toggleAnchorSlot(this)">
              <span class="slot-label">${slot}</span>
            </div>
          `;
        }
      }
      
      grid.innerHTML = html;
    }

    function toggleAnchorSlot(cell) {
      cell.classList.toggle('anchor');
    }

    // ===== Time Rules =====
    function addTimeRule() {
      const list = document.getElementById('timeRulesList');
      const rule = document.createElement('div');
      rule.className = 'time-rule-item';
      rule.innerHTML = `
        <div>
          <div style="font-weight: 600; margin-bottom: 8px; font-size: 0.875rem;">Days Active</div>
          <div class="time-rule-days">
            <button class="day-toggle" data-day="0" onclick="this.classList.toggle('active')">S</button>
            <button class="day-toggle active" data-day="1" onclick="this.classList.toggle('active')">M</button>
            <button class="day-toggle active" data-day="2" onclick="this.classList.toggle('active')">T</button>
            <button class="day-toggle active" data-day="3" onclick="this.classList.toggle('active')">W</button>
            <button class="day-toggle active" data-day="4" onclick="this.classList.toggle('active')">T</button>
            <button class="day-toggle active" data-day="5" onclick="this.classList.toggle('active')">F</button>
            <button class="day-toggle" data-day="6" onclick="this.classList.toggle('active')">S</button>
          </div>
        </div>
        <div>
          <div style="font-size: 0.75rem; color: var(--gray-500); margin-bottom: 4px;">Start</div>
          <input type="time" class="form-input" value="18:00" style="padding: 6px 10px;">
        </div>
        <div>
          <div style="font-size: 0.75rem; color: var(--gray-500); margin-bottom: 4px;">End</div>
          <input type="time" class="form-input" value="20:00" style="padding: 6px 10px;">
        </div>
        <div>
          <div style="font-size: 0.75rem; color: var(--gray-500); margin-bottom: 4px;">Discount</div>
          <input type="number" class="form-input" value="15" min="1" max="50" style="padding: 6px 10px; width: 70px;">
          <span style="font-size: 0.8rem; color: var(--gray-500);">%</span>
        </div>
        <button class="btn btn-icon btn-secondary" style="color: var(--danger);" onclick="this.closest('.time-rule-item').remove()">üóëÔ∏è</button>
      `;
      list.appendChild(rule);
    }

    // ===== Bundle Functions =====
    function addBundle() {
      const list = document.getElementById('bundlesList');
      const bundle = document.createElement('div');
      bundle.className = 'bundle-item';
      bundle.innerHTML = `
        <div class="bundle-header">
          <input type="text" class="form-input" placeholder="Bundle name (e.g., Snack Attack)" style="max-width: 300px;">
          <button class="btn btn-icon btn-secondary" style="color: var(--danger);" onclick="this.closest('.bundle-item').remove()">üóëÔ∏è</button>
        </div>
        <div class="bundle-products">
          <button class="btn btn-sm btn-secondary" onclick="addProductToBundle(this)">+ Add Product</button>
        </div>
        <div class="bundle-pricing">
          <div class="bundle-price-field">
            <span style="font-size: 0.75rem; color: var(--gray-500);">Original Total</span>
            <input type="number" class="form-input" value="0" step="0.25" style="width: 100px;">
          </div>
          <span style="font-size: 1.5rem; color: var(--gray-400);">‚Üí</span>
          <div class="bundle-price-field">
            <span style="font-size: 0.75rem; color: var(--gray-500);">Bundle Price</span>
            <input type="number" class="form-input" value="0" step="0.25" style="width: 100px;">
          </div>
          <div class="bundle-savings">Save 0%</div>
        </div>
      `;
      list.appendChild(bundle);
    }

    function addProductToBundle(btn) {
      const productName = prompt('Enter product name:');
      if (!productName) return;
      
      const tag = document.createElement('div');
      tag.className = 'bundle-product-tag';
      tag.innerHTML = `${productName} <span class="remove" onclick="this.closest('.bundle-product-tag').remove()">&times;</span>`;
      btn.parentElement.insertBefore(tag, btn);
    }

    // ===== Performance Chart =====
    function initPerformanceChart() {
      const ctx = document.getElementById('performanceChart');
      if (!ctx) return;
      
      performanceChart = new Chart(ctx, {
        type: 'bar',
        data: {
          labels: ['Classic Decoy', 'High Anchor', 'Happy Hour', 'Energy Combo', 'Margin Opt'],
          datasets: [
            {
              label: 'Revenue ($)',
              data: [2450, 1890, 1420, 1680, 2100],
              backgroundColor: 'rgba(59, 130, 246, 0.8)',
              borderRadius: 4,
              yAxisID: 'y'
            },
            {
              label: 'Margin %',
              data: [68, 72, 58, 65, 71],
              type: 'line',
              borderColor: 'rgb(34, 197, 94)',
              backgroundColor: 'rgba(34, 197, 94, 0.1)',
              tension: 0.3,
              yAxisID: 'y1'
            }
          ]
        },
        options: {
          responsive: true,
          maintainAspectRatio: false,
          plugins: {
            legend: {
              display: false
            }
          },
          scales: {
            y: {
              type: 'linear',
              position: 'left',
              title: { display: true, text: 'Revenue ($)' },
              grid: { color: 'rgba(0,0,0,0.05)' }
            },
            y1: {
              type: 'linear',
              position: 'right',
              title: { display: true, text: 'Margin %' },
              min: 0,
              max: 100,
              grid: { display: false }
            },
            x: {
              grid: { display: false }
            }
          }
        }
      });
    }

    function updatePerformanceChart() {
      if (!performanceChart) return;
      // Would update with real data from API
      performanceChart.update();
    }

    // ===== Templates =====
    function showTemplates() {
      // Filter to show only templates
      const templateStrategies = strategies.filter(s => s.is_template);
      if (templateStrategies.length === 0) {
        showToast('No templates available. Create a strategy and save as template.', 'info');
        return;
      }
      // For now, just filter the main list
      document.getElementById('filterType').value = '';
      renderStrategies();
      showToast(`Showing ${templateStrategies.length} templates`, 'success');
    }

    // ===== Other Actions =====
    function editStrategy(id) {
      showToast('Edit functionality coming soon!', 'info');
    }

    function createABTest() {
      showToast('A/B testing coming in next update!', 'info');
    }

    function openOverrideModal() {
      showToast('Slot override modal coming soon!', 'info');
    }

    // ===== Utility Functions =====
    function getTypeIcon(type) {
      const icons = {
        decoy: 'üéØ',
        anchoring: '‚öì',
        time_based: '‚è∞',
        bundle_discount: 'üì¶',
        margin_optimization: 'üìà'
      };
      return icons[type] || 'üí∞';
    }

    function getTypeName(type) {
      const names = {
        decoy: 'Decoy Effect',
        anchoring: 'Price Anchoring',
        time_based: 'Time-Based Pricing',
        bundle_discount: 'Bundle Discount',
        margin_optimization: 'Margin Optimization'
      };
      return names[type] || type;
    }

    function getTypeColor(type, isLight = false) {
      const colors = {
        decoy: isLight ? 'var(--purple-light)' : 'var(--purple)',
        anchoring: isLight ? 'var(--warning-light)' : 'var(--warning)',
        time_based: isLight ? 'var(--primary-light)' : 'var(--primary)',
        bundle_discount: isLight ? 'var(--success-light)' : 'var(--success)',
        margin_optimization: isLight ? 'var(--danger-light)' : 'var(--danger)'
      };
      return colors[type] || (isLight ? 'var(--gray-100)' : 'var(--gray-500)');
    }

    function capitalize(str) {
      return str.charAt(0).toUpperCase() + str.slice(1);
    }

    function formatDate(dateStr) {
      if (!dateStr) return 'Unknown';
      const date = new Date(dateStr);
      return date.toLocaleDateString('en-US', { month: 'short', day: 'numeric', year: 'numeric' });
    }

    function showToast(message, type = 'info') {
      const container = document.getElementById('toastContainer');
      const toast = document.createElement('div');
      toast.className = `toast ${type}`;
      toast.innerHTML = `${type === 'success' ? '‚úì' : type === 'error' ? '‚úó' : '‚ÑπÔ∏è'} ${message}`;
      container.appendChild(toast);
      
      setTimeout(() => {
        toast.style.opacity = '0';
        setTimeout(() => toast.remove(), 300);
      }, 3000);
    }

    // ===== Sample Data =====
    function getSampleStrategies() {
      return [
        {
          id: 1,
          name: 'Classic Decoy Effect',
          description: 'Use a medium-priced decoy to make the premium option more attractive.',
          type: 'decoy',
          config: {},
          is_active: true,
          is_template: false,
          machines_applied: 3,
          revenue_lift: '+18%',
          margin: '68%',
          created_at: '2026-01-15T10:00:00Z'
        },
        {
          id: 2,
          name: 'High Anchor Strategy',
          description: 'Place highest-priced items at eye level.',
          type: 'anchoring',
          config: {},
          is_active: true,
          is_template: false,
          machines_applied: 5,
          revenue_lift: '+12%',
          margin: '72%',
          created_at: '2026-01-20T10:00:00Z'
        },
        {
          id: 3,
          name: 'Happy Hour Discount',
          description: 'Time-based pricing for slow periods.',
          type: 'time_based',
          config: {},
          is_active: true,
          is_template: true,
          machines_applied: 0,
          revenue_lift: '+8%',
          margin: '58%',
          created_at: '2026-01-25T10:00:00Z'
        }
      ];
    }

    function getSampleMachines() {
      return [
        { id: 1, name: 'Machine #001', location_name: 'Recreation Center - North Lobby' },
        { id: 2, name: 'Machine #002', location_name: 'Hospital ER - Waiting Area' },
        { id: 3, name: 'Machine #003', location_name: 'Manufacturing Plant - Break Room' },
        { id: 4, name: 'Machine #004', location_name: 'Luxury Apartments - Main Entrance' },
        { id: 5, name: 'Machine #005', location_name: 'Warehouse - Staff Area' }
      ];
    }

    // ===== Event Listeners =====
    document.getElementById('filterType')?.addEventListener('change', renderStrategies);
    
    // Day toggles in time rules
    document.addEventListener('click', (e) => {
      if (e.target.classList.contains('day-toggle')) {
        e.target.classList.toggle('active');
      }
    });
  </script>
</body>
</html>
