<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Kande AI Agent Team ‚Äî Command Center</title>
<style>
  *,*::before,*::after{box-sizing:border-box;margin:0;padding:0}
  :root{
    --bg:#0b0e14;--surface:#131720;--card:#1a1f2e;--card-hover:#1e2438;
    --border:#2a3041;--text:#e2e8f0;--text-dim:#8896ab;--text-muted:#5a6578;
    --accent:#6366f1;--green:#22c55e;--red:#ef4444;--amber:#f59e0b;
    --purple:#8b5cf6;--blue:#3b82f6;--pink:#ec4899;
    --radius:12px;--radius-sm:8px;
  }
  body{font-family:-apple-system,BlinkMacSystemFont,'Segoe UI',Roboto,sans-serif;background:var(--bg);color:var(--text);line-height:1.5;min-height:100vh}
  
  /* Layout */
  .app{display:grid;grid-template-columns:1fr 360px;grid-template-rows:auto auto 1fr auto;min-height:100vh}
  .header{grid-column:1/-1;padding:20px 32px;display:flex;align-items:center;justify-content:space-between;border-bottom:1px solid var(--border);background:var(--surface)}
  .metrics-bar{grid-column:1/-1;padding:16px 32px;display:flex;gap:16px;border-bottom:1px solid var(--border);background:var(--surface)}
  .main{padding:28px 32px;overflow-y:auto;max-height:calc(100vh - 200px)}
  .sidebar{border-left:1px solid var(--border);background:var(--surface);display:flex;flex-direction:column;overflow:hidden;max-height:calc(100vh - 200px)}
  .footer{grid-column:1/-1;padding:16px 32px;border-top:1px solid var(--border);background:var(--surface)}

  /* Header */
  .header-left{display:flex;align-items:center;gap:16px}
  .header-title{font-size:22px;font-weight:700;letter-spacing:-0.3px}
  .header-subtitle{font-size:13px;color:var(--text-dim);text-transform:uppercase;letter-spacing:1.5px;margin-top:2px}
  .status-badge{display:inline-flex;align-items:center;gap:8px;background:#16a34a18;border:1px solid #16a34a40;padding:6px 16px;border-radius:20px;font-size:12px;font-weight:600;color:var(--green);letter-spacing:0.8px;text-transform:uppercase}
  .status-badge .dot{width:8px;height:8px;border-radius:50%;background:var(--green);animation:pulse-dot 2s ease-in-out infinite}
  .header-right{display:flex;align-items:center;gap:16px}
  .header-time{font-size:13px;color:var(--text-dim);font-variant-numeric:tabular-nums}

  /* Metrics */
  .metric-card{flex:1;background:var(--card);border:1px solid var(--border);border-radius:var(--radius-sm);padding:14px 18px;display:flex;flex-direction:column;gap:4px}
  .metric-label{font-size:11px;text-transform:uppercase;letter-spacing:1px;color:var(--text-muted);font-weight:600}
  .metric-value{font-size:28px;font-weight:700;font-variant-numeric:tabular-nums}
  .metric-value.green{color:var(--green)}.metric-value.blue{color:var(--blue)}.metric-value.amber{color:var(--amber)}.metric-value.purple{color:var(--purple)}

  /* Team Groups */
  .team-groups{display:flex;flex-direction:column;gap:20px}
  .team-group{background:var(--surface);border:1px solid var(--border);border-radius:var(--radius);overflow:hidden}
  .team-group-header{padding:14px 20px;display:flex;align-items:center;justify-content:space-between;border-bottom:1px solid var(--border)}
  .team-group-name{font-size:14px;font-weight:600;text-transform:uppercase;letter-spacing:1px;color:var(--text-dim)}
  .team-group-count{font-size:12px;color:var(--text-muted);background:var(--card);padding:2px 10px;border-radius:10px}
  .team-group-agents{display:grid;grid-template-columns:repeat(auto-fill,minmax(320px,1fr));gap:1px;background:var(--border)}

  /* Agent Cards */
  .agent-card{background:var(--card);padding:16px 20px;cursor:pointer;transition:background 0.2s,box-shadow 0.3s;position:relative;overflow:hidden}
  .agent-card:hover{background:var(--card-hover)}
  .agent-card.running{animation:glow-pulse 3s ease-in-out infinite}
  .agent-card.expanded .agent-expand{display:block}
  .agent-top{display:flex;align-items:flex-start;gap:12px}
  .agent-dot{width:10px;height:10px;border-radius:50%;margin-top:5px;flex-shrink:0;transition:background 0.3s}
  .agent-dot.active{background:var(--green);box-shadow:0 0 8px var(--green)}
  .agent-dot.idle{background:var(--text-muted)}
  .agent-dot.meeting{background:var(--amber);box-shadow:0 0 8px var(--amber);animation:pulse-dot 1.5s ease-in-out infinite}
  .agent-info{flex:1;min-width:0}
  .agent-name-row{display:flex;align-items:center;gap:8px;flex-wrap:wrap}
  .agent-name{font-size:15px;font-weight:700}
  .agent-role{font-size:12px;color:var(--text-dim)}
  .agent-model{font-size:11px;font-family:'SF Mono',Monaco,'Cascadia Code',monospace;color:var(--text-muted);background:var(--bg);padding:2px 8px;border-radius:4px;margin-top:4px;display:inline-block}
  .agent-activity{font-size:13px;color:var(--text-dim);margin-top:8px;line-height:1.4;display:flex;align-items:flex-start;gap:6px}
  .agent-activity .activity-icon{flex-shrink:0;margin-top:1px}
  .meeting-badge{display:inline-flex;align-items:center;gap:4px;font-size:11px;background:#f59e0b20;color:var(--amber);border:1px solid #f59e0b40;padding:2px 8px;border-radius:4px;font-weight:600;margin-left:auto}
  .agent-expand{display:none;margin-top:12px;padding-top:12px;border-top:1px solid var(--border);font-size:13px;color:var(--text-dim);line-height:1.6;max-height:150px;overflow-y:auto}
  .agent-expand pre{font-family:'SF Mono',Monaco,monospace;font-size:12px;white-space:pre-wrap;word-break:break-word;color:var(--text-muted);background:var(--bg);padding:10px;border-radius:6px;margin-top:6px}
  .agent-color-bar{position:absolute;left:0;top:0;bottom:0;width:3px}

  /* Sidebar */
  .sidebar-header{padding:16px 20px;border-bottom:1px solid var(--border);display:flex;align-items:center;justify-content:space-between}
  .sidebar-title{font-size:14px;font-weight:600;text-transform:uppercase;letter-spacing:1px;color:var(--text-dim)}
  .sidebar-live{display:flex;align-items:center;gap:6px;font-size:11px;color:var(--green);font-weight:600}
  .sidebar-live .dot{width:6px;height:6px;border-radius:50%;background:var(--green);animation:pulse-dot 2s ease-in-out infinite}
  .activity-feed{flex:1;overflow-y:auto;padding:8px 0}
  .activity-item{padding:10px 20px;border-bottom:1px solid var(--border);transition:background 0.2s}
  .activity-item:hover{background:var(--card)}
  .activity-item.new{animation:fade-in 0.4s ease}
  .activity-time{font-size:11px;color:var(--text-muted);font-variant-numeric:tabular-nums;font-family:'SF Mono',Monaco,monospace}
  .activity-agent{font-size:12px;font-weight:600;margin-top:2px}
  .activity-text{font-size:13px;color:var(--text-dim);margin-top:2px;line-height:1.4}
  .activity-empty{padding:40px 20px;text-align:center;color:var(--text-muted);font-size:13px}

  /* Footer / Schedule */
  .footer-title{font-size:12px;font-weight:600;text-transform:uppercase;letter-spacing:1px;color:var(--text-muted);margin-bottom:10px}
  .schedule-items{display:flex;gap:16px;overflow-x:auto;padding-bottom:4px}
  .schedule-item{display:flex;align-items:center;gap:10px;background:var(--card);border:1px solid var(--border);border-radius:var(--radius-sm);padding:10px 16px;white-space:nowrap;min-width:200px}
  .schedule-time{font-size:12px;font-weight:700;color:var(--accent);font-variant-numeric:tabular-nums}
  .schedule-label{font-size:13px;color:var(--text-dim)}
  .schedule-dot{width:8px;height:8px;border-radius:50%;flex-shrink:0}

  /* Animations */
  @keyframes pulse-dot{0%,100%{opacity:1}50%{opacity:0.4}}
  @keyframes glow-pulse{0%,100%{box-shadow:inset 0 0 0 1px transparent}50%{box-shadow:inset 0 0 0 1px var(--glow-color,var(--accent)),0 0 20px -5px var(--glow-color,var(--accent))}}
  @keyframes fade-in{from{opacity:0;transform:translateY(-8px)}to{opacity:1;transform:translateY(0)}}

  /* Scrollbar */
  ::-webkit-scrollbar{width:6px}
  ::-webkit-scrollbar-track{background:transparent}
  ::-webkit-scrollbar-thumb{background:var(--border);border-radius:3px}
  ::-webkit-scrollbar-thumb:hover{background:var(--text-muted)}

  /* Responsive */
  @media(max-width:900px){
    .app{grid-template-columns:1fr;grid-template-rows:auto auto 1fr auto auto}
    .sidebar{max-height:350px;border-left:none;border-top:1px solid var(--border)}
    .metrics-bar{flex-wrap:wrap}
    .metric-card{min-width:140px}
    .team-group-agents{grid-template-columns:1fr}
  }
</style>
</head>
<body>

<div class="app">
  <!-- Header -->
  <header class="header">
    <div class="header-left">
      <div>
        <div class="header-title">üè¢ Kande AI Agent Team</div>
        <div class="header-subtitle">Command Center</div>
      </div>
    </div>
    <div class="header-right">
      <div class="status-badge"><span class="dot"></span> Operational</div>
      <div class="header-time" id="clock"></div>
    </div>
  </header>

  <!-- Metrics Bar -->
  <div class="metrics-bar">
    <div class="metric-card">
      <div class="metric-label">Runs Today</div>
      <div class="metric-value green" id="m-runs">‚Äî</div>
    </div>
    <div class="metric-card">
      <div class="metric-label">Leads Found</div>
      <div class="metric-value blue" id="m-leads">‚Äî</div>
    </div>
    <div class="metric-card">
      <div class="metric-label">Emails Drafted</div>
      <div class="metric-value amber" id="m-emails">‚Äî</div>
    </div>
    <div class="metric-card">
      <div class="metric-label">Features Shipped</div>
      <div class="metric-value purple" id="m-features">‚Äî</div>
    </div>
  </div>

  <!-- Main Content -->
  <main class="main">
    <div class="team-groups" id="team-groups"></div>
  </main>

  <!-- Activity Sidebar -->
  <aside class="sidebar">
    <div class="sidebar-header">
      <div class="sidebar-title">Activity Feed</div>
      <div class="sidebar-live"><span class="dot"></span> Live</div>
    </div>
    <div class="activity-feed" id="activity-feed">
      <div class="activity-empty">Connecting to activity feed‚Ä¶</div>
    </div>
  </aside>

  <!-- Footer / Schedule -->
  <footer class="footer">
    <div class="footer-title">üìÖ Upcoming Schedule</div>
    <div class="schedule-items" id="schedule-items">
      <div class="schedule-item">
        <div class="schedule-dot" style="background:var(--purple)"></div>
        <div class="schedule-time">09:00</div>
        <div class="schedule-label">Morning Standup</div>
      </div>
      <div class="schedule-item">
        <div class="schedule-dot" style="background:var(--blue)"></div>
        <div class="schedule-time">11:00</div>
        <div class="schedule-label">Scout Research Sprint</div>
      </div>
      <div class="schedule-item">
        <div class="schedule-dot" style="background:var(--green)"></div>
        <div class="schedule-time">14:00</div>
        <div class="schedule-label">Sales Pipeline Review</div>
      </div>
      <div class="schedule-item">
        <div class="schedule-dot" style="background:var(--pink)"></div>
        <div class="schedule-time">16:00</div>
        <div class="schedule-label">Ops Check-in</div>
      </div>
    </div>
  </footer>
</div>

<script>
// ‚îÄ‚îÄ Agent Definitions ‚îÄ‚îÄ
const TEAMS = [
  {
    name: 'Leadership',
    agents: [
      { id:'kurtis', name:'Kurtis', role:'CEO', model:'Human', color:'#f59e0b' },
      { id:'clawd',  name:'Clawd',  role:'Chief of Staff', model:'claude-opus-4-6', color:'#8b5cf6' },
    ]
  },
  {
    name: 'Research Team',
    agents: [
      { id:'scout', name:'Scout', role:'Research Agent', model:'claude-sonnet-4', color:'#3b82f6' },
    ]
  },
  {
    name: 'Sales Team',
    agents: [
      { id:'relay', name:'Relay', role:'Sales Ops Agent', model:'claude-sonnet-4', color:'#22c55e' },
    ]
  },
  {
    name: 'Engineering Team',
    agents: [
      { id:'ralph', name:'Ralph', role:'Engineering Agent', model:'claude-sonnet-4', color:'#f59e0b' },
    ]
  },
  {
    name: 'Operations Team',
    agents: [
      { id:'mary', name:'Mary', role:'PB Ops Agent', model:'claude-sonnet-4', color:'#ec4899' },
    ]
  },
];

// ‚îÄ‚îÄ State ‚îÄ‚îÄ
let agentStates = {};
let activityItems = [];
let expandedAgent = null;

// ‚îÄ‚îÄ Initialize defaults ‚îÄ‚îÄ
TEAMS.forEach(t => t.agents.forEach(a => {
  agentStates[a.id] = { status:'idle', activity:'Waiting for tasks‚Ä¶', inMeeting:false, recentOutput:'' };
}));

// ‚îÄ‚îÄ Clock ‚îÄ‚îÄ
function updateClock() {
  const now = new Date();
  document.getElementById('clock').textContent = now.toLocaleString('en-US', {
    weekday:'short', month:'short', day:'numeric',
    hour:'2-digit', minute:'2-digit', second:'2-digit', hour12:true
  });
}
setInterval(updateClock, 1000);
updateClock();

// ‚îÄ‚îÄ Render Teams ‚îÄ‚îÄ
function renderTeams() {
  const container = document.getElementById('team-groups');
  container.innerHTML = TEAMS.map(team => {
    const totalAgents = team.agents.length;
    const activeCount = team.agents.filter(a => agentStates[a.id]?.status === 'active').length;
    return `
      <div class="team-group">
        <div class="team-group-header">
          <div class="team-group-name">${team.name}</div>
          <div class="team-group-count">${activeCount}/${totalAgents} active</div>
        </div>
        <div class="team-group-agents">
          ${team.agents.map(a => renderAgentCard(a)).join('')}
        </div>
      </div>
    `;
  }).join('');

  // Bind click handlers
  container.querySelectorAll('.agent-card').forEach(card => {
    card.addEventListener('click', () => {
      const id = card.dataset.agentId;
      if (expandedAgent === id) {
        expandedAgent = null;
        card.classList.remove('expanded');
      } else {
        container.querySelectorAll('.agent-card.expanded').forEach(c => c.classList.remove('expanded'));
        expandedAgent = id;
        card.classList.add('expanded');
      }
    });
  });
}

function renderAgentCard(agent) {
  const state = agentStates[agent.id] || {};
  const isActive = state.status === 'active' || state.status === 'running';
  const isRunning = state.status === 'running';
  const inMeeting = state.inMeeting;
  const dotClass = inMeeting ? 'meeting' : (isActive ? 'active' : 'idle');
  const isExpanded = expandedAgent === agent.id;

  return `
    <div class="agent-card ${isRunning ? 'running' : ''} ${isExpanded ? 'expanded' : ''}"
         data-agent-id="${agent.id}"
         style="--glow-color:${agent.color}">
      <div class="agent-color-bar" style="background:${agent.color}"></div>
      <div class="agent-top">
        <div class="agent-dot ${dotClass}"></div>
        <div class="agent-info">
          <div class="agent-name-row">
            <span class="agent-name" style="color:${agent.color}">${agent.name}</span>
            <span class="agent-role">${agent.role}</span>
            ${inMeeting ? '<span class="meeting-badge">üìû In Standup</span>' : ''}
          </div>
          <div class="agent-model">${agent.model}</div>
          <div class="agent-activity">
            <span class="activity-icon">${isActive ? '‚ö°' : 'üí§'}</span>
            <span>${escapeHtml(state.activity || 'Idle')}</span>
          </div>
        </div>
      </div>
      <div class="agent-expand">
        <strong>Recent Output</strong>
        <pre>${escapeHtml(state.recentOutput || 'No recent output.')}</pre>
      </div>
    </div>
  `;
}

// ‚îÄ‚îÄ Render Activity Feed ‚îÄ‚îÄ
function renderActivityFeed() {
  const feed = document.getElementById('activity-feed');
  if (!activityItems.length) {
    feed.innerHTML = '<div class="activity-empty">No activity yet.</div>';
    return;
  }
  feed.innerHTML = activityItems.slice(0, 50).map((item, i) => `
    <div class="activity-item ${i === 0 ? 'new' : ''}">
      <div class="activity-time">${item.time}</div>
      <div class="activity-agent" style="color:${getAgentColor(item.agent)}">${item.agent}</div>
      <div class="activity-text">${escapeHtml(item.text)}</div>
    </div>
  `).join('');
}

// ‚îÄ‚îÄ Update Metrics ‚îÄ‚îÄ
function updateMetrics(data) {
  if (!data) return;
  if (data.runsToday != null) document.getElementById('m-runs').textContent = data.runsToday;
  if (data.leadsFound != null) document.getElementById('m-leads').textContent = data.leadsFound;
  if (data.emailsDrafted != null) document.getElementById('m-emails').textContent = data.emailsDrafted;
  if (data.featuresShipped != null) document.getElementById('m-features').textContent = data.featuresShipped;
}

// ‚îÄ‚îÄ API Polling ‚îÄ‚îÄ
async function fetchTeamStatus() {
  try {
    const res = await fetch('/api/team/status');
    if (!res.ok) throw new Error(res.status);
    const data = await res.json();
    if (data.agents) {
      Object.entries(data.agents).forEach(([id, state]) => {
        agentStates[id] = { ...agentStates[id], ...state };
      });
    }
    if (data.metrics) updateMetrics(data.metrics);
    renderTeams();
  } catch (e) {
    // API not available ‚Äî use demo data
    useDemoData();
    renderTeams();
  }
}

async function fetchActivity() {
  try {
    const res = await fetch('/api/team/activity');
    if (!res.ok) throw new Error(res.status);
    const data = await res.json();
    if (data.items) {
      activityItems = data.items;
      renderActivityFeed();
    }
  } catch (e) {
    // API not available ‚Äî use demo activity
    useDemoActivity();
    renderActivityFeed();
  }
}

// ‚îÄ‚îÄ Demo Data (when API is not connected) ‚îÄ‚îÄ
function useDemoData() {
  const activities = [
    'Monitoring agent pipeline‚Ä¶',
    'Reviewing daily objectives‚Ä¶',
    'Scanning for new leads in Henderson area‚Ä¶',
    'Processing inbound inquiry from website‚Ä¶',
    'Deploying dashboard update v2.4.1‚Ä¶',
    'Checking photo booth event schedule‚Ä¶',
    'Analyzing competitor pricing data‚Ä¶',
    'Drafting follow-up email for lead #847‚Ä¶',
  ];
  const pick = (arr) => arr[Math.floor(Math.random() * arr.length)];

  agentStates.kurtis = { status:'active', activity:'Reviewing daily priorities', inMeeting:false, recentOutput:'Approved Q2 sales strategy.\nSet target: 15 new vending locations by March.' };
  agentStates.clawd = { status:'running', activity:'Coordinating morning standup across all teams', inMeeting:false, recentOutput:'Standup summary: 3 agents active, 2 pending tasks.\nDeployed team.html update.\nNext: check email pipeline.' };
  agentStates.scout = { status:'running', activity:'Researching warehouse districts in North Las Vegas', inMeeting:false, recentOutput:'Found 4 potential locations:\n- Cheyenne Commerce Center (12 units)\n- Craig Industrial Park (8 units)\n- Losee & Ann intersection (6 units)\nScoring by PEOPLE framework‚Ä¶' };
  agentStates.relay = { status:'active', activity:'Following up on 3 warm leads', inMeeting:false, recentOutput:'Lead #842: Sent pricing sheet, awaiting response.\nLead #845: Scheduled site visit for Thursday.\nLead #847: Draft follow-up ready for review.' };
  agentStates.ralph = { status:'running', activity:'Fixing mobile responsive layout on CRM', inMeeting:false, recentOutput:'Bug fix: map pins not loading on Safari.\nCommit: a3f82c1 "Fix Safari WebGL context"\nDeployed to staging.' };
  agentStates.mary = { status:'active', activity:'Confirming Saturday event staffing', inMeeting:false, recentOutput:'Event #PB-2026-0089: Staff confirmed (2/2)\nEquipment check: ‚úÖ Ring light, ‚úÖ Printer\nClient: awaiting final headcount.' };

  updateMetrics({ runsToday: 47, leadsFound: 12, emailsDrafted: 8, featuresShipped: 3 });
}

function useDemoActivity() {
  const now = new Date();
  const fmt = (minAgo) => {
    const d = new Date(now - minAgo * 60000);
    return d.toLocaleTimeString('en-US', { hour:'2-digit', minute:'2-digit', hour12:true });
  };
  activityItems = [
    { time:fmt(1),  agent:'Clawd',  text:'Completed morning standup coordination' },
    { time:fmt(3),  agent:'Scout',  text:'Found 4 potential locations in North Las Vegas' },
    { time:fmt(5),  agent:'Ralph',  text:'Deployed Safari WebGL fix to staging' },
    { time:fmt(8),  agent:'Relay',  text:'Sent pricing sheet to lead #842' },
    { time:fmt(12), agent:'Mary',   text:'Confirmed staff for Saturday event PB-2026-0089' },
    { time:fmt(18), agent:'Scout',  text:'Completed Henderson warehouse district scan' },
    { time:fmt(25), agent:'Clawd',  text:'Updated MEMORY.md with Q2 strategy notes' },
    { time:fmt(30), agent:'Ralph',  text:'Committed map pin clustering optimization' },
    { time:fmt(35), agent:'Relay',  text:'Drafted follow-up for lead #847' },
    { time:fmt(42), agent:'Mary',   text:'Sent equipment checklist to Saturday crew' },
    { time:fmt(50), agent:'Clawd',  text:'Reviewed and merged Scout research findings' },
    { time:fmt(58), agent:'Scout',  text:'Started PEOPLE scoring for new prospects' },
    { time:fmt(65), agent:'Ralph',  text:'Opened PR #127: Mobile CRM responsive fixes' },
    { time:fmt(70), agent:'Relay',  text:'Updated CRM with 3 new lead entries' },
    { time:fmt(80), agent:'Mary',   text:'Processed incoming inquiry via website form' },
  ];
}

// ‚îÄ‚îÄ Helpers ‚îÄ‚îÄ
function escapeHtml(str) {
  const div = document.createElement('div');
  div.textContent = str;
  return div.innerHTML;
}

function getAgentColor(name) {
  const colors = { Kurtis:'#f59e0b', Clawd:'#8b5cf6', Scout:'#3b82f6', Relay:'#22c55e', Ralph:'#f59e0b', Mary:'#ec4899' };
  return colors[name] || 'var(--text)';
}

// ‚îÄ‚îÄ Init ‚îÄ‚îÄ
fetchTeamStatus();
fetchActivity();
setInterval(fetchTeamStatus, 15000);
setInterval(fetchActivity, 15000);
</script>
</body>
</html>
